#########################################
### Effect of clearing broken votings ###
#########################################
update_eu_dirty_variable = {
	if = { limit = { check_variable = { global.EU_dirty_update_var < 10000 } }
		add_to_variable = { global.EU_dirty_update_var = 1 }
	}
	else = {
		set_variable = { global.EU_dirty_update_var = 1 }
	}
}
eu_screen_selection = {
	clr_country_flag = show_eu_parliament # European Parliament
	clr_country_flag = show_euro_voting # European Council
	clr_country_flag = show_eu_fiscal # European budget
	clr_country_flag = show_offices_screen # Offices
	clr_country_flag = show_euro_info # Euro-Info
	update_eu_dirty_variable = yes
}

EU_clear_voting = {
	every_country = {
		limit = { has_country_flag = EU_potential }

		clr_global_flag = EU_qualified_majority_voting
		clr_global_flag = EU_qualified_majority_voting_YES
		clr_global_flag = EU_qualified_majority_voting_NO

		clr_global_flag = focus_EU101_voted
		clr_global_flag = focus_EU101_QMV_voted
		clr_global_flag = focus_EU101_maj_voted
		clr_global_flag = focus_EU102_voted
		clr_global_flag = focus_EU102_QMV_voted
		clr_global_flag = focus_EU102_maj_voted
		clr_global_flag = focus_EU103_voted
		clr_global_flag = focus_EU103_QMV_voted
		clr_global_flag = focus_EU103_maj_voted
		clr_global_flag = focus_EU104_voted
		clr_global_flag = focus_EU104_QMV_voted
		clr_global_flag = focus_EU104_maj_voted
		clr_global_flag = focus_EU105_voted
		clr_global_flag = focus_EU105_QMV_voted
		clr_global_flag = focus_EU105_maj_voted
		clr_global_flag = focus_EU201_voted
		clr_global_flag = focus_EU201_QMV_voted
		clr_global_flag = focus_EU201_maj_voted
		clr_global_flag = focus_EU202_voted
		clr_global_flag = focus_EU202_QMV_voted
		clr_global_flag = focus_EU202_maj_voted
		clr_global_flag = focus_EU203_voted
		clr_global_flag = focus_EU203_QMV_voted
		clr_global_flag = focus_EU203_maj_voted
		clr_global_flag = focus_EU204_voted
		clr_global_flag = focus_EU204_QMV_voted
		clr_global_flag = focus_EU204_maj_voted
		clr_global_flag = focus_EU205_voted
		clr_global_flag = focus_EU205_QMV_voted
		clr_global_flag = focus_EU205_maj_voted
		clr_global_flag = focus_EU206_voted
		clr_global_flag = focus_EU206_QMV_voted
		clr_global_flag = focus_EU206_maj_voted
		clr_global_flag = focus_EU207_voted
		clr_global_flag = focus_EU207_QMV_voted
		clr_global_flag = focus_EU207_maj_voted
		clr_global_flag = focus_EU208_voted
		clr_global_flag = focus_EU208_QMV_voted
		clr_global_flag = focus_EU208_maj_voted
		clr_global_flag = focus_EU301_voted
		clr_global_flag = focus_EU301_QMV_voted
		clr_global_flag = focus_EU301_maj_voted
		clr_global_flag = focus_EU302_voted
		clr_global_flag = focus_EU302_QMV_voted
		clr_global_flag = focus_EU302_maj_voted
		clr_global_flag = focus_EU303_voted
		clr_global_flag = focus_EU303_QMV_voted
		clr_global_flag = focus_EU303_maj_voted
		clr_global_flag = focus_EU304_voted
		clr_global_flag = focus_EU304_QMV_voted
		clr_global_flag = focus_EU304_maj_voted
		clr_global_flag = focus_EU305_voted
		clr_global_flag = focus_EU305_QMV_voted
		clr_global_flag = focus_EU305_maj_voted
		clr_global_flag = focus_EU306_voted
		clr_global_flag = focus_EU306_QMV_voted
		clr_global_flag = focus_EU306_maj_voted
		clr_global_flag = focus_EU307_voted
		clr_global_flag = focus_EU307_QMV_voted
		clr_global_flag = focus_EU307_maj_voted
		clr_global_flag = focus_EU308_voted
		clr_global_flag = focus_EU308_QMV_voted
		clr_global_flag = focus_EU308_maj_voted
		clr_global_flag = focus_EU401_voted
		clr_global_flag = focus_EU401_QMV_voted
		clr_global_flag = focus_EU401_maj_voted
		clr_global_flag = focus_EU402_voted
		clr_global_flag = focus_EU402_QMV_voted
		clr_global_flag = focus_EU402_maj_voted
		clr_global_flag = focus_EU403_voted
		clr_global_flag = focus_EU403_QMV_voted
		clr_global_flag = focus_EU403_maj_voted
		clr_global_flag = focus_EU404_voted
		clr_global_flag = focus_EU404_QMV_voted
		clr_global_flag = focus_EU404_maj_voted
		clr_global_flag = focus_EU405_voted
		clr_global_flag = focus_EU405_QMV_voted
		clr_global_flag = focus_EU405_maj_voted
		clr_global_flag = focus_EU406_voted
		clr_global_flag = focus_EU406_QMV_voted
		clr_global_flag = focus_EU406_maj_voted
		clr_global_flag = focus_EU407_voted
		clr_global_flag = focus_EU407_QMV_voted
		clr_global_flag = focus_EU407_maj_voted
		clr_global_flag = focus_EU408_voted
		clr_global_flag = focus_EU408_QMV_voted
		clr_global_flag = focus_EU408_maj_voted
		clr_global_flag = focus_EU601_voted
		clr_global_flag = focus_EU601_QMV_voted
		clr_global_flag = focus_EU601_maj_voted
		clr_global_flag = focus_EU602_voted
		clr_global_flag = focus_EU602_QMV_voted
		clr_global_flag = focus_EU602_maj_voted
		clr_global_flag = focus_EU603_voted
		clr_global_flag = focus_EU603_QMV_voted
		clr_global_flag = focus_EU603_maj_voted
		clr_global_flag = focus_EU703_voted
		clr_global_flag = focus_EU703_QMV_voted
		clr_global_flag = focus_EU703_maj_voted
		clr_global_flag = focus_EU110_voted
		clr_global_flag = focus_EU110_QMV_voted
		clr_global_flag = focus_EU110_maj_voted
		clr_global_flag = focus_EU111_voted
		clr_global_flag = focus_EU111_QMV_voted
		clr_global_flag = focus_EU111_maj_voted
		clr_global_flag = focus_EU112_voted
		clr_global_flag = focus_EU112_QMV_voted
		clr_global_flag = focus_EU112_maj_voted
		clr_global_flag = focus_EU605_voted
		clr_global_flag = focus_EU605_QMV_voted
		clr_global_flag = focus_EU605_maj_voted
		clr_global_flag = focus_EU606_voted
		clr_global_flag = focus_EU606_QMV_voted
		clr_global_flag = focus_EU606_maj_voted
		clr_global_flag = focus_EU607_voted
		clr_global_flag = focus_EU607_QMV_voted
		clr_global_flag = focus_EU607_maj_voted
		clr_global_flag = focus_EU608_voted
		clr_global_flag = focus_EU608_QMV_voted
		clr_global_flag = focus_EU608_maj_voted
		clr_global_flag = focus_EU609_voted
		clr_global_flag = focus_EU609_QMV_voted
		clr_global_flag = focus_EU609_maj_voted
		clr_global_flag = focus_EU610_voted
		clr_global_flag = focus_EU610_QMV_voted
		clr_global_flag = focus_EU610_maj_voted
		clr_global_flag = focus_EU611_voted
		clr_global_flag = focus_EU611_QMV_voted
		clr_global_flag = focus_EU611_maj_voted
		clr_global_flag = focus_EU650_voted
		clr_global_flag = focus_EU650_QMV_voted
		clr_global_flag = focus_EU650_maj_voted
		clr_global_flag = focus_EU651_voted
		clr_global_flag = focus_EU651_QMV_voted
		clr_global_flag = focus_EU651_maj_voted
		clr_global_flag = focus_EU652_voted
		clr_global_flag = focus_EU652_QMV_voted
		clr_global_flag = focus_EU652_maj_voted
		clr_global_flag = focus_EU653_voted
		clr_global_flag = focus_EU653_QMV_voted
		clr_global_flag = focus_EU653_maj_voted
		###result flags
		clr_global_flag = focus_EU101_result
		clr_global_flag = focus_EU101_QMV_result
		clr_global_flag = focus_EU101_maj_result
		clr_global_flag = focus_EU102_result
		clr_global_flag = focus_EU102_QMV_result
		clr_global_flag = focus_EU102_maj_result
		clr_global_flag = focus_EU103_result
		clr_global_flag = focus_EU103_QMV_result
		clr_global_flag = focus_EU103_maj_result
		clr_global_flag = focus_EU104_result
		clr_global_flag = focus_EU104_QMV_result
		clr_global_flag = focus_EU104_maj_result
		clr_global_flag = focus_EU105_result
		clr_global_flag = focus_EU105_QMV_result
		clr_global_flag = focus_EU105_maj_result
		clr_global_flag = focus_EU201_result
		clr_global_flag = focus_EU201_QMV_result
		clr_global_flag = focus_EU201_maj_result
		clr_global_flag = focus_EU202_result
		clr_global_flag = focus_EU202_QMV_result
		clr_global_flag = focus_EU202_maj_result
		clr_global_flag = focus_EU203_result
		clr_global_flag = focus_EU203_QMV_result
		clr_global_flag = focus_EU203_maj_result
		clr_global_flag = focus_EU204_result
		clr_global_flag = focus_EU204_QMV_result
		clr_global_flag = focus_EU204_maj_result
		clr_global_flag = focus_EU205_result
		clr_global_flag = focus_EU205_QMV_result
		clr_global_flag = focus_EU205_maj_result
		clr_global_flag = focus_EU206_result
		clr_global_flag = focus_EU206_QMV_result
		clr_global_flag = focus_EU206_maj_result
		clr_global_flag = focus_EU207_result
		clr_global_flag = focus_EU207_QMV_result
		clr_global_flag = focus_EU207_maj_result
		clr_global_flag = focus_EU208_result
		clr_global_flag = focus_EU208_QMV_result
		clr_global_flag = focus_EU208_maj_result
		clr_global_flag = focus_EU301_result
		clr_global_flag = focus_EU301_QMV_result
		clr_global_flag = focus_EU301_maj_result
		clr_global_flag = focus_EU302_result
		clr_global_flag = focus_EU302_QMV_result
		clr_global_flag = focus_EU302_maj_result
		clr_global_flag = focus_EU303_result
		clr_global_flag = focus_EU303_QMV_result
		clr_global_flag = focus_EU303_maj_result
		clr_global_flag = focus_EU304_result
		clr_global_flag = focus_EU304_QMV_result
		clr_global_flag = focus_EU304_maj_result
		clr_global_flag = focus_EU305_result
		clr_global_flag = focus_EU305_QMV_result
		clr_global_flag = focus_EU305_maj_result
		clr_global_flag = focus_EU306_result
		clr_global_flag = focus_EU306_QMV_result
		clr_global_flag = focus_EU306_maj_result
		clr_global_flag = focus_EU307_result
		clr_global_flag = focus_EU307_QMV_result
		clr_global_flag = focus_EU307_maj_result
		clr_global_flag = focus_EU308_result
		clr_global_flag = focus_EU308_QMV_result
		clr_global_flag = focus_EU308_maj_result
		clr_global_flag = focus_EU401_result
		clr_global_flag = focus_EU401_QMV_result
		clr_global_flag = focus_EU401_maj_result
		clr_global_flag = focus_EU402_result
		clr_global_flag = focus_EU402_QMV_result
		clr_global_flag = focus_EU402_maj_result
		clr_global_flag = focus_EU403_result
		clr_global_flag = focus_EU403_QMV_result
		clr_global_flag = focus_EU403_maj_result
		clr_global_flag = focus_EU404_result
		clr_global_flag = focus_EU404_QMV_result
		clr_global_flag = focus_EU404_maj_result
		clr_global_flag = focus_EU405_result
		clr_global_flag = focus_EU405_QMV_result
		clr_global_flag = focus_EU405_maj_result
		clr_global_flag = focus_EU406_result
		clr_global_flag = focus_EU406_QMV_result
		clr_global_flag = focus_EU406_maj_result
		clr_global_flag = focus_EU407_result
		clr_global_flag = focus_EU407_QMV_result
		clr_global_flag = focus_EU407_maj_result
		clr_global_flag = focus_EU408_result
		clr_global_flag = focus_EU408_QMV_result
		clr_global_flag = focus_EU408_maj_result
		clr_global_flag = focus_EU601_result
		clr_global_flag = focus_EU601_QMV_result
		clr_global_flag = focus_EU601_maj_result
		clr_global_flag = focus_EU602_result
		clr_global_flag = focus_EU602_QMV_result
		clr_global_flag = focus_EU602_maj_result
		clr_global_flag = focus_EU603_result
		clr_global_flag = focus_EU603_QMV_result
		clr_global_flag = focus_EU603_maj_result
		clr_global_flag = focus_EU703_result
		clr_global_flag = focus_EU703_QMV_result
		clr_global_flag = focus_EU703_maj_result
		clr_global_flag = focus_EU110_result
		clr_global_flag = focus_EU110_QMV_result
		clr_global_flag = focus_EU110_maj_result
		clr_global_flag = focus_EU111_result
		clr_global_flag = focus_EU111_QMV_result
		clr_global_flag = focus_EU111_maj_result
		clr_global_flag = focus_EU112_result
		clr_global_flag = focus_EU112_QMV_result
		clr_global_flag = focus_EU112_maj_result
		clr_global_flag = focus_EU605_result
		clr_global_flag = focus_EU605_QMV_result
		clr_global_flag = focus_EU605_maj_result
		clr_global_flag = focus_EU606_result
		clr_global_flag = focus_EU606_QMV_result
		clr_global_flag = focus_EU606_maj_result
		clr_global_flag = focus_EU607_result
		clr_global_flag = focus_EU607_QMV_result
		clr_global_flag = focus_EU607_maj_result
		clr_global_flag = focus_EU608_result
		clr_global_flag = focus_EU608_QMV_result
		clr_global_flag = focus_EU608_maj_result
		clr_global_flag = focus_EU609_result
		clr_global_flag = focus_EU609_QMV_result
		clr_global_flag = focus_EU609_maj_result
		clr_global_flag = focus_EU610_result
		clr_global_flag = focus_EU610_QMV_result
		clr_global_flag = focus_EU610_maj_result
		clr_global_flag = focus_EU611_result
		clr_global_flag = focus_EU611_QMV_result
		clr_global_flag = focus_EU611_maj_result
		clr_global_flag = focus_EU650_result
		clr_global_flag = focus_EU650_QMV_result
		clr_global_flag = focus_EU650_maj_result
		clr_global_flag = focus_EU651_result
		clr_global_flag = focus_EU651_QMV_result
		clr_global_flag = focus_EU651_maj_result
		clr_global_flag = focus_EU652_result
		clr_global_flag = focus_EU652_QMV_result
		clr_global_flag = focus_EU652_maj_result
		clr_global_flag = focus_EU653_result
		clr_global_flag = focus_EU653_QMV_result
		clr_global_flag = focus_EU653_maj_result
	}
	update_eu_dirty_variable = yes
}

##############################################
##############################################
### EU scripted effects to use for modding ###
##############################################
##############################################

EU_update_vars = {
	custom_effect_tooltip = tooltip_EU_update_ration_euroscepticism_europeanism
	hidden_effect = {
		# EU population vars update
		# Sets Global EU Population and Country Population
		set_variable = { var = global.var_EUpopTotal value = 0 }
		for_each_scope_loop = {
			array = global.EU_member
			set_temp_variable = { converted_manpower = max_manpower_k }
			divide_temp_variable = { converted_manpower = 100 }
			set_variable = { EU_member_state_population = converted_manpower }
			divide_variable = { EU_member_state_population = 10 } #Converts to millions for use in display
			add_to_variable = { global.var_EUpopTotal = converted_manpower }
		}
		set_variable = { var = global.var_EUpopTotalDisplay value = global.var_EUpopTotal }
		divide_variable = { global.var_EUpopTotalDisplay = 10 }

		# Sets the total number of EU Member States
		set_variable = { var = global.EU_member_count value = 0 }
		for_each_scope_loop = {
			array = global.EU_member
			add_to_variable = { global.EU_member_count = 1 }
		}

		# Calculates Pop Ratio
		for_each_scope_loop = {
			array = global.EU_member
			set_variable = { THIS.EU_pop_ratio = 0 }
			add_to_variable = { THIS.EU_pop_ratio = THIS.max_manpower_k }
			divide_variable = { THIS.EU_pop_ratio = 100 } # Converts to 100,000 to match the GDP
			divide_variable = { THIS.EU_pop_ratio = global.var_EUpopTotal }
		}
		# End of EU Population Calculations

		# Euroscepticism update
		for_each_scope_loop = {
			array = global.EU_member
			clamp_variable = { var = THIS.eurosceptic min = 0 max = 1 }
		}
		###End of Euroscepticism update

		###Europeanism update
		set_variable = { var = global.var_europeanism value = 0 }

		for_each_scope_loop = {
			array = global.EU_member
			set_variable = { THIS.var_proeuropean = 1 }

			subtract_from_variable = { THIS.var_proeuropean = THIS.eurosceptic }
			set_temp_variable = { converted_manpower = max_manpower_k }
			divide_temp_variable = { converted_manpower = 100 }
			multiply_variable = { THIS.var_proeuropean = converted_manpower }
		}

		for_each_scope_loop = {
			array = global.EU_member
			add_to_variable = { global.var_europeanism = THIS.var_proeuropean }
		}
		divide_variable = { global.var_europeanism = global.var_EUpopTotal }
		###End of Europeanism update

		# Calculate the Total var for QMV
		set_temp_variable = { total_member_states = 0 }
		for_each_scope_loop = {
			array = global.EU_member
			add_to_temp_variable = { total_member_states = 1 }
		}
		set_temp_variable = { qmv_majority_states = total_member_states }
		multiply_temp_variable = { qmv_majority_states = 0.55 }
		round_temp_variable = qmv_majority_states

		set_variable = { global.EU_total_qmv_state = total_member_states }
		set_variable = { global.EU_majority_qmv_state = qmv_majority_states }
	}
	update_eu_dirty_variable = yes
}

########################################
### Changing Euroscepticism of a tag ###
########################################
# set_temp_variable = { modify_eurosceptic = +- }
# set_temp_variable = { modify_eurosceptic_target = ROOT/THIS/PREV/FROM or country TAG }
eurosceptic_change = {
	custom_effect_tooltip = tooltip_eurosceptic_change
	hidden_effect = {
		log = "[GetDateText]: [FROM.GetTag]: 99_EU_scripted_effects [?modify_eurosceptic_target] eurosceptic_change [?modify_eurosceptic]"
		var:modify_eurosceptic_target = { add_to_variable = { eurosceptic = modify_eurosceptic } }
		EU_update_vars = yes
	}
}

##############################################################
### Changing Euroscepticism of all (current) member states ###
##############################################################

# set_temp_variable = { modify_eurosceptic = +- }
EU_eurosceptic_change = {
	custom_effect_tooltip = tooltip_EU_eurosceptic_change
	hidden_effect = {
		log = "[GetDateText]: [FROM.GetTag]: 99_EU_scripted_effects EU_eurosceptic_change [?modify_eurosceptic]"
		for_each_scope_loop = {
			array = global.EU_member
			add_to_variable = { THIS.eurosceptic = modify_eurosceptic }
		}
		EU_update_vars = yes
	}
}

##########################################################################
### Changing Euroscepticism of all current AND potential member states ###
##########################################################################

# set_temp_variable = { modify_eurosceptic = +- }
EU_potential_eurosceptic_change = {
	custom_effect_tooltip = tooltip_EU_potential_eurosceptic_change
	hidden_effect = {
		log = "[GetDateText]: [FROM.GetTag]: 99_EU_scripted_effects EU_potential_eurosceptic_change [?modify_eurosceptic]"
		for_each_scope_loop = {
			array = global.EU_potential
			add_to_variable = { THIS.eurosceptic = modify_eurosceptic }
		}
		EU_update_vars = yes
	}
}

### Inventment in the single market
### use in country scope
### TAG is investee
invest_in_EU_single_market_cic = {
	if = {
		limit = {
			any_owned_state = {
				free_building_slots = {
					building = industrial_complex size > 0
					include_locked = no
				}
			}
		}
		custom_effect_tooltip = tooltip_invest_in_EU_single_market_cic
		hidden_effect = {
			random_owned_state = {
				limit = {
					free_building_slots = {
						building = industrial_complex size > 0
						include_locked = no
					}
				}
				invest_cic = yes
			}

		}
		set_temp_variable = { modify_eurosceptic = -0.03 }
		set_temp_variable = { modify_eurosceptic_target = THIS }
		eurosceptic_change = yes
		set_temp_variable = { modify_eurosceptic_target = ROOT }
		eurosceptic_change = yes
	}
}

invest_in_EU_single_market_infra = {
	if = {
		limit = {
			any_owned_state = {
				infrastructure < 5
			}
		}
		custom_effect_tooltip = tooltip_invest_in_EU_single_market_infra
		hidden_effect = {
			random_owned_state = {
				limit = { infrastructure < 5 }
				invest_infra = yes
			}
		}
		set_temp_variable = { modify_eurosceptic = -0.03 }
		set_temp_variable = { modify_eurosceptic_target = THIS }
		eurosceptic_change = yes
		set_temp_variable = { modify_eurosceptic_target = ROOT }
		eurosceptic_change = yes
		update_eu_dirty_variable = yes
	}
}

EU_money_for_influence = {
	custom_effect_tooltip = tooltip_EU_money_for_influence
	hidden_effect = {
		add_to_variable = { THIS.treasury = 10 }
		set_temp_variable = { percent_change = 1 }
		set_temp_variable = { tag_index = ROOT.id }
		set_temp_variable = { influence_target = THIS.id }
		change_influence_percentage = yes
	}
	set_temp_variable = { modify_eurosceptic = -0.03 }
	set_temp_variable = { modify_eurosceptic_target = THIS }
	eurosceptic_change = yes
	set_temp_variable = { modify_eurosceptic_target = ROOT }
	eurosceptic_change = yes
	update_eu_dirty_variable = yes
}

################################
### ECB OMT scripted effects ###
################################

execute_OMT = {
	custom_effect_tooltip = tooltip_ECB_Outright_Monetary_Transactions_complete_effect
	hidden_effect = {
		every_country = {
			limit = { has_idea = EU_member }
			#log = "start OTM interest_rate [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
			if = {
				limit = {
					has_idea = the_euro
					check_variable = {
						var = THIS.debt
						value = 10000.0
						compare = greater_than_or_equals
					}
				}
				set_variable = {
					var = THIS.OMT_account
					value = 0
				}
				while_loop_effect = {
						limit = {
							check_variable = { THIS.interest_rate > 4.0 }
							check_variable = { global.OMT_size_limit > global.OMT_total_value }
						}
						#log = "while_loop_effect interest_rate [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
						if = {
							limit = {
								check_variable = { THIS.interest_rate > 4.0 }
							}
							#log = "[THIS.GetTag] subtract_from_variable = { THIS.debt = 1000.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							subtract_from_variable = { THIS.debt = 1000.0 }
							#log = "[THIS.GetTag] add_to_variable = { THIS.OMT_account = 1000.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							add_to_variable = { THIS.OMT_account = 1000.0 }
							#log = "[THIS.GetTag] add_to_variable = { global.OMT_total_value = 1000.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							add_to_variable = { global.OMT_total_value = 1000.0 }
							calculate_interest_rate = yes
						}
				}
			}
			else_if = {
				limit = {
					has_idea = the_euro
					check_variable = { THIS.debt < 10000.0 }
					check_variable = {
						var = THIS.debt
						value = 1000.0
						compare = greater_than_or_equals
					}
				}
				set_variable = {
					var = THIS.OMT_account
					value = 0
				}
				while_loop_effect = {
					limit = {
						check_variable = { THIS.interest_rate > 4.0 }
						check_variable = { global.OMT_size_limit > global.OMT_total_value }
					}
						if = {
							limit = {
								check_variable = { THIS.interest_rate > 4.0 }
							}

							#log = "[THIS.GetTag] subtract_from_variable = { THIS.debt = 100.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							subtract_from_variable = { THIS.debt = 100.0 }
							#log = "[THIS.GetTag] add_to_variable = { THIS.OMT_account = 100.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							add_to_variable = { THIS.OMT_account = 100.0 }
							#log = "[THIS.GetTag] add_to_variable = { global.OMT_total_value = 100.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							add_to_variable = { global.OMT_total_value = 100.0 }
							#log = "[THIS.GetTag] calculate_interest_rate = yes [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							calculate_interest_rate = yes

						}
				}
			}
			else_if = {
				limit = {
					has_idea = the_euro
					check_variable = { THIS.debt < 1000.0 }
					check_variable = {
						var = THIS.debt
						value = 100.0
						compare = greater_than_or_equals
					}
				}
				set_variable = {
					var = THIS.OMT_account
					value = 0
				}
				while_loop_effect = {
						limit = {
							check_variable = { THIS.interest_rate > 4.0 }
							check_variable = { global.OMT_size_limit > global.OMT_total_value }
						}
						if = {
							limit = {
								check_variable = { THIS.interest_rate > 4.0 }
							}

							#log = "[THIS.GetTag] subtract_from_variable = { THIS.debt = 10.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							subtract_from_variable = { THIS.debt = 10.0 }
							#log = "[THIS.GetTag] add_to_variable = { THIS.OMT_account = 10.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							add_to_variable = { THIS.OMT_account = 10.0 }
							#log = "[THIS.GetTag] add_to_variable = { global.OMT_total_value = 10.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							add_to_variable = { global.OMT_total_value = 10.0 }
							#log = "[THIS.GetTag] calculate_interest_rate = yes [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							calculate_interest_rate = yes
						}
				}
			}
			else_if = {
				limit = {
					has_idea = the_euro
					check_variable = { THIS.debt < 100.0 }
					check_variable = {
						var = THIS.debt
						value = 10.0
						compare = greater_than_or_equals
					}
				}
				set_variable = {
					var = THIS.OMT_account
					value = 0
				}
				while_loop_effect = {
						limit = {
							check_variable = { THIS.interest_rate > 4.0 }
							check_variable = { global.OMT_size_limit > global.OMT_total_value }
						}
						if = {
							limit = {
								check_variable = { THIS.interest_rate > 4.0 }
							}

							#log = "[THIS.GetTag] subtract_from_variable = { THIS.debt = 1.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							subtract_from_variable = { THIS.debt = 1.0 }
							#log = "[THIS.GetTag] add_to_variable = { THIS.OMT_account = 1.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							add_to_variable = { THIS.OMT_account = 1.0 }
							#log = "[THIS.GetTag] add_to_variable = { global.OMT_total_value = 1.0 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							add_to_variable = { global.OMT_total_value = 1.0 }
							#log = "[THIS.GetTag] calculate_interest_rate = yes [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
							calculate_interest_rate = yes
						}
				}
			}
			else_if = {
				limit = {
					has_idea = the_euro
					check_variable = { THIS.debt < 10.0 }
					check_variable = {
						var = THIS.debt
						value = 1.0
						compare = greater_than_or_equals
					}
				}
				set_variable = {
					var = THIS.OMT_account
					value = 0
				}
				while_loop_effect = {
					limit = {
						check_variable = { THIS.interest_rate > 4.0 }
						check_variable = { global.OMT_size_limit > global.OMT_total_value }
					}
					if = {
						limit = {
							check_variable = { THIS.interest_rate > 4.0 }
						}

						#log = "[THIS.GetTag] subtract_from_variable = { THIS.debt = 0.1 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
						subtract_from_variable = { THIS.debt = 0.1 }
						#log = "[THIS.GetTag] add_to_variable = { THIS.OMT_account = 0.1 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
						add_to_variable = { THIS.OMT_account = 0.1 }
						#log = "[THIS.GetTag] add_to_variable = { global.OMT_total_value = 0.1 } [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
						add_to_variable = { global.OMT_total_value = 0.1 }
						#log = "[THIS.GetTag] calculate_interest_rate = yes [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
						calculate_interest_rate = yes

					}
				}
			}
		}
	}
	update_eu_dirty_variable = yes
}

remove_OMT = {
	custom_effect_tooltip = tooltip_ECB_Outright_Monetary_Transactions_remove_effect
	hidden_effect = {
		every_country = {
			limit = {
				has_idea = EU_member
			}
			if = {
				limit = {
					has_idea = the_euro
				}
				log = "remove_effect interest_rate [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
				add_to_variable = {
					var = THIS.debt
					value = THIS.OMT_account
				}
				clear_variable = THIS.OMT_account
				clear_variable = global.OMT_total_value
				log = "remove_effect end interest_rate [THIS.GetTag] [?THIS.interest_rate] debt [?THIS.debt] OMT_size_limit [?global.OMT_size_limit] OMT_total_value [?global.OMT_total_value]"
			}
		}
	}
	update_eu_dirty_variable = yes
}

#####################################
### Leaving EU scripted effects  ####
#####################################

leaving_EU = {
	if = {
		limit = { NOT = { has_country_flag = EUU_do_not_remove_eu_idea } }
		remove_ideas = EU_member
	}
	EU_clear_voting = yes ### new one
	remove_ideas = the_euro
	custom_effect_tooltip = tooltip_EU_remove_laws_and_offices
	hidden_effect = {
		every_other_country = {
			limit = { has_idea = EU_member }
			PREV = {
				remove_opinion_modifier = { target = PREV modifier = EU_member_opinion }
			}
			remove_opinion_modifier = { target = PREV modifier = EU_member_opinion }
		}
		### EU law and offices
		# European Union Laws
		remove_ideas = EUU_CFR_EU
		remove_ideas = ECB_zero_interest_rate_policy
		remove_ideas = euro_bonds
		remove_ideas = european_debt_crisis
		remove_ideas = euro_rescue_package
		remove_ideas = fiscal_union
		remove_ideas = European_Economic_Government
		remove_from_tech_sharing_group = EU_Tech_Share
		remove_ideas = European_Defence_Fund
		remove_ideas = European_Security_Council
		remove_ideas = EUU_idea_gdpr
		remove_ideas = EU_copyright
		remove_ideas = Migrant_Crisis_Europe
		remove_ideas = relocation_asylum_seekers
		remove_ideas = EU_Turkey_deal
		remove_ideas = European_Asylum_Agency
		remove_ideas = Frontex
		# EU offices
		if = { limit = { has_idea = EU_commission_president }
			remove_ideas = EU_commission_president
		}
		if = { limit = { has_idea = EU_council_president }
			remove_ideas = EU_council_president
		}
		if = { limit = { has_idea = EU_foreign_minister }
			remove_ideas = EU_foreign_minister
		}
		if = { limit = { has_idea = EU_parliament_president }
			remove_ideas = EU_parliament_president
		}
		if = { limit = { has_idea = ECB_president }
			remove_ideas = ECB_president
		}
		if = { limit = { has_idea = EU_finance_minister }
			remove_ideas = EU_finance_minister
		}
		if = { limit = { has_idea = frontex_ExDir }
			remove_ideas = frontex_ExDir
		}
		if = { limit = { has_idea = EUU_euronavy_sc }
			remove_ideas = EUU_euronavy_sc
		}
		if = { limit = { has_idea = EUU_euroarmy_sc }
			remove_ideas = EUU_euroarmy_sc
		}
		if = { limit = { has_idea = EUU_ambassador_unsc }
			remove_ideas = EUU_ambassador_unsc
		}
		if = { limit = { has_idea = EU_president }
			remove_ideas = EU_president
		}
		if = {
			limit = {
				has_idea = EUU_ambassador_unsc
				NOT = {
					tag = ENG
					tag = FRA
					has_country_flag = reformed_council
				}
			}
			remove_ideas = p5_member
		}
		### End of EU law and offices
		### leave EDU
		if = { limit = { has_global_flag = EDU }
			leave_faction = yes
		}
		### clear focus flags for leaving, set for remaining
		if = { limit = { has_country_flag = focus_EU101_yes }
			clr_country_flag = focus_EU101_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU101_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU101_QMV_yes }
			clr_country_flag = focus_EU101_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU101_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU102_yes }
			clr_country_flag = focus_EU102_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU102_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU102_QMV_yes }
			clr_country_flag = focus_EU102_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU102_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU103_yes }
			clr_country_flag = focus_EU103_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU103_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU103_QMV_yes }
			clr_country_flag = focus_EU103_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU103_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU104_yes }
			clr_country_flag = focus_EU104_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU104_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU104_QMV_yes }
			clr_country_flag = focus_EU104_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU104_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU105_yes }
			clr_country_flag = focus_EU105_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU105_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU105_QMV_yes }
			clr_country_flag = focus_EU105_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU105_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU201_yes }
			clr_country_flag = focus_EU201_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU201_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU201_QMV_yes }
				 clr_country_flag = focus_EU201_QMV_yes
				random_country = {
					limit = { has_idea = EU_member }
					set_country_flag = focus_EU201_QMV_yes
				}
		}
		if = { limit = { has_country_flag = focus_EU202_yes }
			clr_country_flag = focus_EU202_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU202_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU202_QMV_yes }
			clr_country_flag = focus_EU202_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU202_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU203_yes }
			clr_country_flag = focus_EU203_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU203_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU203_QMV_yes }
			clr_country_flag = focus_EU203_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU203_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU204_yes }
			clr_country_flag = focus_EU204_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU204_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU204_QMV_yes }
			clr_country_flag = focus_EU204_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU204_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU205_yes }
			clr_country_flag = focus_EU205_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU205_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU205_QMV_yes }
			clr_country_flag = focus_EU205_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU205_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU206_yes }
			clr_country_flag = focus_EU206_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU206_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU206_QMV_yes }
			clr_country_flag = focus_EU206_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU206_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU207_yes }
			clr_country_flag = focus_EU207_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU207_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU207_QMV_yes }
			clr_country_flag = focus_EU207_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU207_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU208_yes }
			clr_country_flag = focus_EU208_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU208_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU208_QMV_yes }
			clr_country_flag = focus_EU208_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU208_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU301_yes }
			clr_country_flag = focus_EU301_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU301_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU301_QMV_yes }
			clr_country_flag = focus_EU301_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU301_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU302_yes }
			clr_country_flag = focus_EU302_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU302_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU302_QMV_yes }
			clr_country_flag = focus_EU302_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU302_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU303_yes }
			clr_country_flag = focus_EU303_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU303_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU303_QMV_yes }
			clr_country_flag = focus_EU303_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU303_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU304_yes }
			clr_country_flag = focus_EU304_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU304_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU304_QMV_yes }
			clr_country_flag = focus_EU304_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU304_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU305_yes }
			clr_country_flag = focus_EU305_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU305_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU305_QMV_yes }
			clr_country_flag = focus_EU305_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU305_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU306_yes }
			clr_country_flag = focus_EU306_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU306_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU306_QMV_yes }
			clr_country_flag = focus_EU306_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU306_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU307_yes }
			clr_country_flag = focus_EU307_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU307_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU307_QMV_yes }
			clr_country_flag = focus_EU307_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU307_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU308_yes }
			clr_country_flag = focus_EU308_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU308_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU308_QMV_yes }
			clr_country_flag = focus_EU308_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU308_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU401_yes }
			clr_country_flag = focus_EU401_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU401_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU401_QMV_yes }
			clr_country_flag = focus_EU401_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU401_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU402_yes }
			clr_country_flag = focus_EU402_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU402_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU402_QMV_yes }
			clr_country_flag = focus_EU402_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU402_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU403_yes }
			clr_country_flag = focus_EU403_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU403_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU403_QMV_yes }
			clr_country_flag = focus_EU403_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU403_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU404_yes }
			clr_country_flag = focus_EU404_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU404_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU404_QMV_yes }
			clr_country_flag = focus_EU404_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU404_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU405_yes }
			clr_country_flag = focus_EU405_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU405_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU405_QMV_yes }
			clr_country_flag = focus_EU405_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU405_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU406_yes }
			clr_country_flag = focus_EU406_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU406_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU406_QMV_yes }
			clr_country_flag = focus_EU406_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU406_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU407_yes }
			clr_country_flag = focus_EU407_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU407_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU407_QMV_yes }
			clr_country_flag = focus_EU407_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU407_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU408_yes }
			clr_country_flag = focus_EU408_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU408_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU408_QMV_yes }
			clr_country_flag = focus_EU408_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU408_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU601_yes }
			clr_country_flag = focus_EU601_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU601_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU601_QMV_yes }
			clr_country_flag = focus_EU601_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU601_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU602_yes }
			clr_country_flag = focus_EU602_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU602_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU602_QMV_yes }
			clr_country_flag = focus_EU602_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU602_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU603_yes }
			clr_country_flag = focus_EU603_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU603_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU603_QMV_yes }
			clr_country_flag = focus_EU603_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU603_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU110_yes }
			clr_country_flag = focus_EU110_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU110_yes
			}
		}
		if = {
			limit = {
				 has_country_flag = focus_EU110_QMV_yes
			}
				 clr_country_flag = focus_EU110_QMV_yes
				random_country = {
					limit = { has_idea = EU_member }
					set_country_flag = focus_EU110_QMV_yes
				}
		}
		if = { limit = { has_country_flag = focus_EU111_yes }
			clr_country_flag = focus_EU111_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU111_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU111_QMV_yes }
			clr_country_flag = focus_EU111_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU111_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU112_yes }
			clr_country_flag = focus_EU112_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU112_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU112_QMV_yes }
			clr_country_flag = focus_EU112_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU112_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU605_yes }
			clr_country_flag = focus_EU605_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU605_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU605_QMV_yes }
			clr_country_flag = focus_EU605_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU605_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU606_yes }
			clr_country_flag = focus_EU606_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU606_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU606_QMV_yes }
			clr_country_flag = focus_EU606_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU606_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU607_yes }
			clr_country_flag = focus_EU607_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU607_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU607_QMV_yes }
			clr_country_flag = focus_EU607_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU607_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU608_yes }
			clr_country_flag = focus_EU608_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU608_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU608_QMV_yes }
			clr_country_flag = focus_EU608_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU608_QMV_yes
			}
		}
		if = {
			limit = {
				 has_country_flag = focus_EU609_yes
			}
				 clr_country_flag = focus_EU609_yes
				random_country = {
					limit = { has_idea = EU_member }
					set_country_flag = focus_EU609_yes
				}
		}
		if = { limit = { has_country_flag = focus_EU609_QMV_yes }
				 clr_country_flag = focus_EU609_QMV_yes
				random_country = {
					limit = { has_idea = EU_member }
					set_country_flag = focus_EU609_QMV_yes
				}
		}
		if = { limit = { has_country_flag = focus_EU610_yes }
				 clr_country_flag = focus_EU610_yes
				random_country = {
					limit = { has_idea = EU_member }
					set_country_flag = focus_EU610_yes
				}
		}
		if = { limit = { has_country_flag = focus_EU610_QMV_yes }
				 clr_country_flag = focus_EU610_QMV_yes
				random_country = {
					limit = { has_idea = EU_member }
					set_country_flag = focus_EU610_QMV_yes
				}
		}
		if = { limit = { has_country_flag = focus_EU611_yes }
				 clr_country_flag = focus_EU611_yes
				random_country = {
					limit = { has_idea = EU_member }
					set_country_flag = focus_EU611_yes
				}
		}
		if = { limit = { has_country_flag = focus_EU611_QMV_yes }
			clr_country_flag = focus_EU611_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU611_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU650_yes }
				 clr_country_flag = focus_EU650_yes
				random_country = {
					limit = { has_idea = EU_member }
					set_country_flag = focus_EU650_yes
				}
		}
		if = { limit = { has_country_flag = focus_EU650_QMV_yes }
			clr_country_flag = focus_EU650_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU650_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU651_yes }
				 clr_country_flag = focus_EU651_yes
				random_country = {
					limit = { has_idea = EU_member }
					set_country_flag = focus_EU651_yes
				}
		}
		if = { limit = { has_country_flag = focus_EU651_QMV_yes }
			clr_country_flag = focus_EU651_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU651_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU652_yes }
				 clr_country_flag = focus_EU652_yes
				random_country = {
					limit = { has_idea = EU_member }
					set_country_flag = focus_EU652_yes
				}
		}
		if = { limit = { has_country_flag = focus_EU652_QMV_yes }
			clr_country_flag = focus_EU652_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU652_QMV_yes
			}
		}
		if = { limit = { has_country_flag = focus_EU653_yes }
				 clr_country_flag = focus_EU653_yes
				random_country = {
					limit = { has_idea = EU_member }
					set_country_flag = focus_EU653_yes
				}
		}
		if = { limit = { has_country_flag = focus_EU653_QMV_yes }
			clr_country_flag = focus_EU653_QMV_yes
			random_country = {
				limit = { has_idea = EU_member }
				set_country_flag = focus_EU653_QMV_yes
			}
		}

		### end of focus flag clearing and setting
	}
	update_eu_dirty_variable = yes
}

##########################
### breach of EU value ###
##########################
#TODO: Set flags to allow people to see what their cause of the breach is
check_breach_of_EU_value = {
	set_variable = { THIS.breach_of_EU_value = 0 }
	### Corruption Level Addition ###
	if = { limit = { has_idea = paralyzing_corruption }
		add_to_variable = { THIS.breach_of_EU_value = 5 }
	}
	else_if = { limit = { has_idea = crippling_corruption }
		add_to_variable = { THIS.breach_of_EU_value = 4 }
	}
	else_if = { limit = { has_idea = rampant_corruption }
		add_to_variable = { THIS.breach_of_EU_value = 3 }
	}
	else_if = { limit = { has_idea = unrestrained_corruption }
		add_to_variable = { THIS.breach_of_EU_value = 2 }
	}
	else_if = { limit = { has_idea = systematic_corruption }
		add_to_variable = { THIS.breach_of_EU_value = 1 }
	}
	### peace ###
	if = {
		limit = {
			has_offensive_war = yes
			any_enemy_country = {
				has_idea = EU_member
			}
		}
		add_to_variable = { THIS.breach_of_EU_value = 10 }
	}
	### government ###
	if = { limit = { has_communist_in_coalition = yes }
		add_to_variable = { THIS.breach_of_EU_value = 1 }
	}
	if = { limit = { has_reactionary_in_coalition = yes }
		add_to_variable = { THIS.breach_of_EU_value = 1 }
	}
	if = { limit = { has_communist_government = yes }
		add_to_variable = { THIS.breach_of_EU_value = 2 }
	}
	if = { limit = { has_reactionary_government = yes }
		add_to_variable = { THIS.breach_of_EU_value = 2 }
	}
	### women ###
	if = { limit = { has_idea = no_women_in_military }
		add_to_variable = { THIS.breach_of_EU_value = 1 }
	}
	### intervention ###
	if = { limit = { has_idea = intervention_neo_imperialism }
		add_to_variable = { THIS.breach_of_EU_value = 1 }
	}
	### minorities ###
	if = { limit = { check_variable = { election_threshold > 0.095 } }
		add_to_variable = { THIS.breach_of_EU_value = 1 }
	}
	### no bailout ###
	if = { limit = { has_idea = bankrupcy }
		add_to_variable = { THIS.breach_of_EU_value = 1 }
	}
	if = { limit = { has_country_flag = bailout_given }
		add_to_variable = { THIS.breach_of_EU_value = 1 }
	}
	### elections ###
	if = { limit = { NOT = { has_elections = yes } }
		add_to_variable = { THIS.breach_of_EU_value = 5 }
	}
	### democracy ###
	if = { limit = { has_idea = dictatorship }
		add_to_variable = { THIS.breach_of_EU_value = 5 }
	}
	if = { limit = { has_idea = communist_dictatorship }
		add_to_variable = { THIS.breach_of_EU_value = 5 }
	}
	if = { limit = { has_idea = fascist_dictatorship }
		add_to_variable = { THIS.breach_of_EU_value = 5 }
	}
	if = { limit = { is_subject = yes }
		add_to_variable = { THIS.breach_of_EU_value = 4 }
	}
	update_eu_dirty_variable = yes
}

#############################
### USoE scripted effects ###
#############################

update_EU_military_leaders = {
	custom_effect_tooltip = tooltip_update_EU_military_leaders
	every_unit_leader = {
		limit = {
			has_unit_leader_flag = USoE_unit_leader
		}
		remove_unit_leader_trait = military_reorganization
	}
	update_eu_dirty_variable = yes
}

update_EU_country_leaders = {
	custom_effect_tooltip = tooltip_update_EU_country_leaders
	set_country_flag = USoE_country_leader
	set_country_flag = USoE_political_parties
}

create_eurosphere = {
	every_country = {
		limit = {
			capital_scope = {
				OR = {
					is_on_continent = europe
					is_on_continent = africa
					is_on_continent = middle_east
				}
			}
			is_neighbor_of = PREV
			influence_higher_50 = yes
		}
		custom_effect_tooltip = tooltip_create_eurosphere
		set_temp_variable = { percent_change = 2 }
		set_temp_variable = { tag_index = ROOT.id }
		set_temp_variable = { influence_target = THIS.id }
		change_influence_percentage = yes
	}
}

catholic_leadership = {
	every_country = {
		limit = { has_idea = christian }
		add_opinion_modifier = {
			target = ROOT
			modifier = friendly_monarchy
		}
		reverse_add_opinion_modifier = {
			target = ROOT
			modifier = friendly_monarchy
		}
	}
}

christian_leadership = {
	every_country = {
		limit = {
			OR = {
				has_idea = christian
				has_idea = orthodox_christian
			}
		}
		add_opinion_modifier = {
			target = ROOT
			modifier = friendly_monarchy
		}
		reverse_add_opinion_modifier = {
			target = ROOT
			modifier = friendly_monarchy
		}
	}
}

set_USoE_flag_of_the_house = {
	if = { limit = { has_country_flag = USoE_house_of_savoy }
		set_cosmetic_tag = USoE_SAV
	}
	else_if = { limit = { has_country_flag = USoE_house_of_wittelsbach }
		set_cosmetic_tag = USoE_WIT
	}
	else_if = { limit = { has_country_flag = USoE_house_of_borbon_anjou }
		set_cosmetic_tag = USoE_BOR_ANJ
	}
	else_if = { limit = { has_country_flag = USoE_house_of_bourbon }
		set_cosmetic_tag = USoE_BOR
	}
	else_if = { limit = { has_country_flag = USoE_house_of_hanover }
		set_cosmetic_tag = USoE_HAN
	}
	else_if = { limit = { has_country_flag = USoE_house_of_glucksburg }
		set_cosmetic_tag = USoE_GLU
	}
	else_if = { limit = { has_country_flag = USoE_house_of_windsor }
		set_cosmetic_tag = USoE_WIN
	}
	else_if = { limit = { has_country_flag = USoE_house_of_orange_nassau }
		set_cosmetic_tag = USoE_ORA
	}
	else_if = { limit = { has_country_flag = USoE_house_of_habsburg_lorraine }
		set_cosmetic_tag = USoE_HAB
	}
	else_if = { limit = { has_country_flag = USoE_house_of_bonaparte }
		set_cosmetic_tag = USoE_NAP
	}
	else_if = { limit = { has_country_flag = USoE_house_of_hohenzollern }
		set_cosmetic_tag = USoE_HOH
	}
}

# EU Startup Configuration
on_startup_euu_action = {
	# Disable The EU
	if = {
		limit = {
			has_game_rule = {
				rule = rule_disable_eu
				option = yes
			}
		}
		every_country = {
			limit = { has_idea = EU_member }
			remove_ideas = {
				the_euro
				EU_member
				foreign_data_kraken
				asylum_shopping
			}
		}
		set_global_flag = GAME_RULE_eu_disabled
	}

	if = {
		limit = {
			has_game_rule = {
				rule = rule_european_union_voting_limits
				option = one
			}
		}
		set_global_flag = GAME_RULE_eu_one_cooldown
	}
	if = {
		limit = {
			has_game_rule = {
				rule = rule_european_union_voting_limits
				option = sixty
			}
		}
		set_global_flag = GAME_RULE_eu_sixty_cooldown
	}
	if = {
		limit = {
			has_game_rule = {
				rule = rule_european_union_voting_limits
				option = ninety
			}
		}
		set_global_flag = GAME_RULE_eu_ninety_cooldown
	}
	if = {
		limit = {
			has_game_rule = {
				rule = rule_european_union_voting_limits
				option = two_hundred_ten
			}
		}
		set_global_flag = GAME_RULE_eu_two_hundred_ten_cooldown
	}
	if = {
		limit = {
			has_game_rule = {
				rule = rule_european_union_voting_limits
				option = one_hundred_eighty
			}
		}
		set_global_flag = GAME_RULE_eu_one_hundred_eighty_cooldown
	}
	if = {
		limit = {
			has_game_rule = {
				rule = rule_european_union_voting_limits
				option = one_hundred_twenty
			}
		}
		set_global_flag = GAME_RULE_eu_one_hundred_twenty_cooldown
	}

	# Configure European Union startup values and information
	if = { limit = { NOT = { has_global_flag = GAME_RULE_eu_disabled } }
		EUU = {
			add_to_array = { global.EU_potential_votes = 101 } # Charter of Fundamental Rights of the EU
			add_to_array = { global.EU_potential_votes = 102 } # European Convention
			add_to_array = { global.EU_potential_votes = 103 } # European Constitution
			add_to_array = { global.EU_potential_votes = 104 } # Treaty of Lisbon
			add_to_array = { global.EU_potential_votes = 105 } # European External Action Service
			add_to_array = { global.EU_potential_votes = 201 } # ECB Intervention
			add_to_array = { global.EU_potential_votes = 202 } # European Banking Union
			add_to_array = { global.EU_potential_votes = 203 } # Eurobonds
			add_to_array = { global.EU_potential_votes = 204 } # European Financial Stability Facility (EFSF)
			add_to_array = { global.EU_potential_votes = 205 } # European Stability Mechanism (ESM)
			add_to_array = { global.EU_potential_votes = 206 } # Fiscal Union
			add_to_array = { global.EU_potential_votes = 207 } # European Economic Government
			add_to_array = { global.EU_potential_votes = 208 } # European Minister of Economy and Finance
			add_to_array = { global.EU_potential_votes = 301 } # European Defence Agency (EDA)
			add_to_array = { global.EU_potential_votes = 302 } # Permanent Structured Cooperation (PESCO)
			add_to_array = { global.EU_potential_votes = 303 } # European Defence Fund
			add_to_array = { global.EU_potential_votes = 304 } # European Security Council
			add_to_array = { global.EU_potential_votes = 305 } # EuroArmy
			add_to_array = { global.EU_potential_votes = 306 } # EuroNavy
			add_to_array = { global.EU_potential_votes = 307 } # EU Permanent Member of the UNSC
			add_to_array = { global.EU_potential_votes = 308 } # EU Nuclear Power
			add_to_array = { global.EU_potential_votes = 401 } # General Data Protection Regulation
			add_to_array = { global.EU_potential_votes = 402 } # Directive on Copyright in the Digital Single Market
			add_to_array = { global.EU_potential_votes = 403 } # Dublin II Regulations
			add_to_array = { global.EU_potential_votes = 404 } # Relocation and Resettlement of Asylum Seekers
			add_to_array = { global.EU_potential_votes = 405 } # EU-Turkey Deal
			add_to_array = { global.EU_potential_votes = 406 } # European Asylum Agency
			add_to_array = { global.EU_potential_votes = 407 } # Frontex
			add_to_array = { global.EU_potential_votes = 408 } # European Border & Coast Guard Agency
			add_to_array = { global.EU_potential_votes = 601 } # 2004 EU Enlargement
			add_to_array = { global.EU_potential_votes = 602 } # 2007 EU Enlargement
			add_to_array = { global.EU_potential_votes = 603 } # 2013 EU Enlargement
			add_to_array = { global.EU_potential_votes = 605 } # Western Balkans Enlargement
			add_to_array = { global.EU_potential_votes = 606 } # Turkey
			add_to_array = { global.EU_potential_votes = 607 } # Black Sea Enlargement
			add_to_array = { global.EU_potential_votes = 608 } # Caucasus Enlargement
			add_to_array = { global.EU_potential_votes = 609 } # European Economic Area
			add_to_array = { global.EU_potential_votes = 610 } # Belarus
			add_to_array = { global.EU_potential_votes = 611 } # Internal Enlargement
			add_to_array = { global.EU_potential_votes = 650 } # Extended Enlargement Framework
			add_to_array = { global.EU_potential_votes = 651 } # Lisbon Treaty Amendment
			add_to_array = { global.EU_potential_votes = 652 } # EU-Russia Partnership Treaty
			add_to_array = { global.EU_potential_votes = 653 } # Russia
			add_to_array = { global.EU_potential_votes = 110 } # Federalisation of the European Union
			add_to_array = { global.EU_potential_votes = 111 } # United States of Europe
			add_to_array = { global.EU_potential_votes = 112 } # European Federation

			#base voting array for pp calcuations
			add_to_array = { array = global.starting_mep_support_parliment value = -100 }
			add_to_array = { array = global.starting_mep_support_parliment value = -50 }
			add_to_array = { array = global.starting_mep_support_parliment value = 0 }
			add_to_array = { array = global.starting_mep_support_parliment value = 50 }
			add_to_array = { array = global.starting_mep_support_parliment value = 100 }

			add_to_array = { global.EU_member = AUS }
			add_to_array = { global.EU_member = BEL }
			add_to_array = { global.EU_member = DEN }
			add_to_array = { global.EU_member = ENG }
			add_to_array = { global.EU_member = FIN }
			add_to_array = { global.EU_member = FRA }
			add_to_array = { global.EU_member = GER }
			add_to_array = { global.EU_member = GRE }
			add_to_array = { global.EU_member = HOL }
			add_to_array = { global.EU_member = IRE }
			add_to_array = { global.EU_member = ITA }
			add_to_array = { global.EU_member = LUX }
			add_to_array = { global.EU_member = POR }
			add_to_array = { global.EU_member = SPR }
			add_to_array = { global.EU_member = SWE }

			add_to_array = { global.EU_potential = ALB }
			add_to_array = { global.EU_potential = ARM }
			add_to_array = { global.EU_potential = AUS }
			add_to_array = { global.EU_potential = AZE }
			add_to_array = { global.EU_potential = BEL }
			add_to_array = { global.EU_potential = BLR }
			add_to_array = { global.EU_potential = BOS }
			add_to_array = { global.EU_potential = BUL }
			add_to_array = { global.EU_potential = CAT }
			add_to_array = { global.EU_potential = CRE }
			add_to_array = { global.EU_potential = CRO }
			add_to_array = { global.EU_potential = CYP }
			add_to_array = { global.EU_potential = CZE }
			add_to_array = { global.EU_potential = DEN }
			add_to_array = { global.EU_potential = ENG }
			add_to_array = { global.EU_potential = EST }
			add_to_array = { global.EU_potential = FIN }
			add_to_array = { global.EU_potential = FRA }
			add_to_array = { global.EU_potential = FYR }
			add_to_array = { global.EU_potential = GEO }
			add_to_array = { global.EU_potential = GER }
			add_to_array = { global.EU_potential = GRE }
			add_to_array = { global.EU_potential = HOL }
			add_to_array = { global.EU_potential = HUN }
			add_to_array = { global.EU_potential = ICE }
			add_to_array = { global.EU_potential = IRE }
			add_to_array = { global.EU_potential = ITA }
			add_to_array = { global.EU_potential = KOS }
			add_to_array = { global.EU_potential = LAT }
			add_to_array = { global.EU_potential = LIT }
			add_to_array = { global.EU_potential = LUX }
			add_to_array = { global.EU_potential = MLT }
			add_to_array = { global.EU_potential = MLV }
			add_to_array = { global.EU_potential = MNT }
			add_to_array = { global.EU_potential = NOR }
			add_to_array = { global.EU_potential = POL }
			add_to_array = { global.EU_potential = POR }
			add_to_array = { global.EU_potential = ROM }
			add_to_array = { global.EU_potential = RUS }
			add_to_array = { global.EU_potential = SCL }
			add_to_array = { global.EU_potential = SCO }
			add_to_array = { global.EU_potential = SER }
			add_to_array = { global.EU_potential = SLO }
			add_to_array = { global.EU_potential = SLV }
			add_to_array = { global.EU_potential = SOV }
			add_to_array = { global.EU_potential = SPR }
			add_to_array = { global.EU_potential = SWE }
			add_to_array = { global.EU_potential = SWI }
			add_to_array = { global.EU_potential = TUR }
			add_to_array = { global.EU_potential = UKR }
			add_to_array = { global.EU_potential = WAS }
			add_to_array = { global.EU_potential = HLS }
			add_to_array = { global.EU_potential = SMA }
			add_to_array = { global.EU_potential = MNC }
			add_to_array = { global.EU_potential = ADO }
			add_to_array = { global.EU_potential = LIC }
			add_to_array = { global.EU_potential = GAL }
			add_to_array = { global.EU_potential = SIL }
			add_to_array = { global.EU_potential = SPA }
			add_to_array = { global.EU_potential = CNR }
			add_to_array = { global.EU_potential = NAV }
			add_to_array = { global.EU_potential = BAY }
			add_to_array = { global.EU_potential = GRL }

			country_event = { id = EUupdate.1 }

			EU_update_vars = yes
			every_country = {
				limit = { has_idea = EU_member }
				activate_mission = EU_budget_draft_preparations
				activate_mission = EU_mff_draft_preparations
				set_country_flag = EU_budget_EP_block
			}
			for_each_scope_loop = {
				array = global.EU_member
				set_variable = { THIS.EU_budget_call_rate = 1 }
			}
			set_variable = { global.EU_budget_min_call_rate = 1 }
			set_EU_gdp = yes
			EU_global_click_cost = yes
			update_EU_budget_call_rate = yes 
			update_EU_average_eco_lvl = yes
			set_EU_expenditure = yes
			distribute_EU_budget = yes
		}

		set_variable = { global.eucouncil = EUU.id }
		set_variable = { global.eucomission = EUU.id }
		set_variable = { global.eucentralbank = EUU.id }
		set_variable = { global.euforeignaffairs = EUU.id }
		set_variable = { global.euparliamentpresident = EUU.id }
		set_variable = { global.eufinance = EUU.id }
		set_variable = { global.eufrontex = EUU.id }
		set_variable = { global.euarmy = EUU.id }
		set_variable = { global.eunavy = EUU.id }
		set_variable = { global.euambassador = EUU.id }
		set_variable = { global.eupresfederation = EUU.id }
	}

	add_to_array = { global.EU_parl_party_number = 0 }
	add_to_array = { global.EU_parl_party_number = 1 }
	add_to_array = { global.EU_parl_party_number = 2 }
	add_to_array = { global.EU_parl_party_number = 3 }
	add_to_array = { global.EU_parl_party_number = 4 }
	add_to_array = { global.EU_parl_party_number = 5 }
	add_to_array = { global.EU_parl_party_number = 6 }
	add_to_array = { global.EU_parl_party_number = 7 }
	add_to_array = { global.EU_parl_party_number = 8 }
	add_to_array = { global.EU_parl_party_number = 9 }
	add_to_array = { global.EU_parl_party_number = 10 }
	add_to_array = { global.EU_parl_party_number = 11 }
	add_to_array = { global.EU_parl_party_number = 12 }
	add_to_array = { global.EU_parl_party_number = 13 }
	add_to_array = { global.EU_parl_party_number = 14 }
	add_to_array = { global.EU_parl_party_number = 15 }
	add_to_array = { global.EU_parl_party_number = 16 }
	add_to_array = { global.EU_parl_party_number = 17 }
	add_to_array = { global.EU_parl_party_number = 18 }
	add_to_array = { global.EU_parl_party_number = 19 }
	add_to_array = { global.EU_parl_party_number = 20 }
	add_to_array = { global.EU_parl_party_number = 21 }
	add_to_array = { global.EU_parl_party_number = 22 }
	add_to_array = { global.EU_parl_party_number = 23 }

	update_eu_dirty_variable = yes
}

set_the_eu_parliament_delay = {
	hidden_effect = {
		if = {
			limit = { has_global_flag = GAME_RULE_eu_one_cooldown }
			every_country = {
				limit = { has_idea = EU_member }
				set_country_flag = { flag = delay_next_parliament_vote value = 1 days = 1 }
				if = {
					limit = { is_ai = no }
					country_event = { id = EUvote.3 days = 1 }
				}
			}
			set_global_flag = { flag = EP_AI_hold_their_vote value = 1 days = 1 }
		}
		if = {
			limit = { has_global_flag = GAME_RULE_eu_sixty_cooldown }
			every_country = {
				limit = { has_idea = EU_member }
				set_country_flag = { flag = delay_next_parliament_vote value = 1 days = 60 }
				if = {
					limit = { is_ai = no }
					country_event = { id = EUvote.3 days = 60 }
				}
			}
			set_global_flag = { flag = EP_AI_hold_their_vote value = 1 days = 74 }
		}
		if = {
			limit = { has_global_flag = GAME_RULE_eu_ninety_cooldown }
			every_country = {
				limit = { has_idea = EU_member }
				set_country_flag = { flag = delay_next_parliament_vote value = 1 days = 90 }
				if = {
					limit = { is_ai = no }
					country_event = { id = EUvote.3 days = 90 }
				}
			}
			set_global_flag = { flag = EP_AI_hold_their_vote value = 1 days = 104 }
		}
		if = {
			limit = { has_global_flag = GAME_RULE_eu_one_hundred_twenty_cooldown }
			every_country = {
				limit = { has_idea = EU_member }
				set_country_flag = { flag = delay_next_parliament_vote value = 1 days = 120 }
				if = {
					limit = { is_ai = no }
					country_event = { id = EUvote.3 days = 120 }
				}
			}
			set_global_flag = { flag = EP_AI_hold_their_vote value = 1 days = 134 }
		}
		if = {
			limit = { has_global_flag = GAME_RULE_eu_one_hundred_eighty_cooldown }
			every_country = {
				limit = { has_idea = EU_member }
				set_country_flag = { flag = delay_next_parliament_vote value = 1 days = 180 }
				if = {
					limit = { is_ai = no }
					country_event = { id = EUvote.3 days = 180 }
				}
			}
			set_global_flag = { flag = EP_AI_hold_their_vote value = 1 days = 194 }
		}
		if = {
			limit = { has_global_flag = GAME_RULE_eu_two_hundred_ten_cooldown }
			every_country = {
				limit = { has_idea = EU_member }
				set_country_flag = { flag = delay_next_parliament_vote value = 1 days = 210 }
				if = {
					limit = { is_ai = no }
					country_event = { id = EUvote.3 days = 210 }
				}
			}
			set_global_flag = { flag = EP_AI_hold_their_vote value = 1 days = 224 }

		}
	}
}

set_the_eu_council_delay = {
	hidden_effect = {
		if = {
			limit = { has_global_flag = GAME_RULE_eu_one_cooldown }
			set_country_flag = { flag = delay_player_next_council_vote value = 1 days = 1 }
			set_global_flag = { flag = delay_next_council_vote value = 1 days = 1 }
			set_global_flag = { flag = delay_next_council_vote_ai value = 1 days = 1 }
			if = {
				limit = { is_ai = no }
				country_event = { id = EUvote.4 days = 1 }
			}
		}
		if = {
			limit = { has_global_flag = GAME_RULE_eu_sixty_cooldown }
			set_country_flag = { flag = delay_player_next_council_vote value = 1 days = 60 }
			set_global_flag = { flag = delay_next_council_vote value = 1 days = 60 }
			set_global_flag = { flag = delay_next_council_vote_ai value = 1 days = 74 }
			if = {
				limit = { is_ai = no }
				country_event = { id = EUvote.4 days = 60 }
			}
		}
		if = {
			limit = { has_global_flag = GAME_RULE_eu_ninety_cooldown }
			set_country_flag = { flag = delay_player_next_council_vote value = 1 days = 90 }
			set_global_flag = { flag = delay_next_council_vote value = 1 days = 90 }
			set_global_flag = { flag = delay_next_council_vote_ai value = 1 days = 104 }
			if = {
				limit = { is_ai = no }
				country_event = { id = EUvote.4 days = 90 }
			}
		}
		if = {
			limit = { has_global_flag = GAME_RULE_eu_one_hundred_twenty_cooldown }
			set_country_flag = { flag = delay_player_next_council_vote value = 1 days = 120 }
			set_global_flag = { flag = delay_next_council_vote value = 1 days = 120 }
			set_global_flag = { flag = delay_next_council_vote_ai value = 1 days = 134 }
			if = {
				limit = { is_ai = no }
				country_event = { id = EUvote.4 days = 120 }
			}
		}
		if = {
			limit = { has_global_flag = GAME_RULE_eu_one_hundred_eighty_cooldown }
			set_country_flag = { flag = delay_player_next_council_vote value = 1 days = 180 }
			set_global_flag = { flag = delay_next_council_vote value = 1 days = 180 }
			set_global_flag = { flag = delay_next_council_vote_ai value = 1 days = 194 }
			if = {
				limit = { is_ai = no }
				country_event = { id = EUvote.4 days = 180 }
			}
		}
		if = {
			limit = { has_global_flag = GAME_RULE_eu_two_hundred_ten_cooldown }
			set_country_flag = { flag = delay_player_next_council_vote value = 1 days = 210 }
			set_global_flag = { flag = delay_next_council_vote value = 1 days = 210 }
			set_global_flag = { flag = delay_next_council_vote_ai value = 1 days = 224 }
			if = {
				limit = { is_ai = no }
				country_event = { id = EUvote.4 days = 210 }
			}
		}
	}
}

# POTEF Scripted Effects
POTEF_election = {
	clear_POTEF_variables = yes
	clear_array = POTEF_winner_array
	clear_array = POTEF_pop_vote_array
	clear_array = POTEF_pop_vote_ratio_array
	resize_array = { POTEF_winner_array = 23 }
	resize_array = { POTEF_pop_vote_array = 23 }
	resize_array = { POTEF_pop_vote_ratio_array = 23 }
	every_country = {
		limit = { has_idea = EU_member }
		election_POTEF_in_member_state = yes
	}
	update_POTEF_arrays = yes
	update_eu_dirty_variable = yes
}

election_POTEF_in_member_state = {
	for_each_loop = {
		array = party_pop_array
		set_variable = { THIS.POTEF_pop_vote^i = party_pop_array^i }
		multiply_variable = { THIS.POTEF_pop_vote^i = THIS.max_manpower_k }
		add_to_variable = { global.POTEF_pop_vote^i = THIS.POTEF_pop_vote^i }
		add_to_variable = { global.POTEF_pop_vote_total = THIS.POTEF_pop_vote^i }
	}
	find_highest_in_array = {
		array = party_pop_array
		value = max_1_tmp
		index = max_index_1_tmp
	}
	set_variable = { THIS.POTEF_winner_value = max_1_tmp }
	set_variable = { THIS.POTEF_winner = max_index_1_tmp }
	add_to_variable = { global.POTEF_winner^max_index_1_tmp = 1 }
	update_eu_dirty_variable = yes
}

clear_POTEF_variables = {
	clear_variable = global.POTEF_pop_vote_total
	for_loop_effect = {
		end = 23
		value = i
		clear_variable = global.POTEF_winner^i
		clear_variable = global.POTEF_pop_vote^i
		clear_variable = global.POTEF_pop_vote_ratio^i
	}
	update_eu_dirty_variable = yes
}

update_POTEF_arrays = {
	for_each_loop = {
		array = POTEF_winner_array
		add_to_array = {
			array = POTEF_winner_array
			value = global.POTEF_winner^i
			index = i
		}
	}
	for_each_loop = {
		array = POTEF_pop_vote_array
		add_to_array = {
			array = POTEF_pop_vote_array
			value = global.POTEF_pop_vote^i
			index = i
		}
	}
	for_each_loop = {
		array = POTEF_pop_vote_ratio_array
		set_variable = { global.POTEF_pop_vote_ratio^i = global.POTEF_pop_vote^i }
		divide_variable = { global.POTEF_pop_vote_ratio^i = global.POTEF_pop_vote_total }
		add_to_array = {
			array = POTEF_pop_vote_ratio_array
			value = global.POTEF_pop_vote_ratio^i
			index = i
		}
	}
	update_eu_dirty_variable = yes
}

set_POTEF_elect = {
	set_temp_variable = { camp_time = 90 }
	if = {
		limit = {
			absolute_majority_member_states = yes
			absolute_majority_popular_vote = yes
			#identical?
			check_variable = { max_index_1_tmp = max_index_2_tmp }
		}
		set_variable = { POTEF_elect = max_index_2_tmp }
		### five-year term
		set_variable = { POTEF_term = 1825 } #1825
	}
	else_if = {
		limit = {
			relative_majority_member_states = yes
			absolute_majority_popular_vote = yes
			#identical?
			check_variable = { max_index_1_tmp = max_index_2_tmp }
		}
		set_variable = { POTEF_elect = max_index_2_tmp }
		### three-year term
		set_variable = { POTEF_term = 1095 } #1095
	}
	else_if = {
		limit = {
			absolute_majority_member_states = yes
			relative_majority_popular_vote = yes
			#identical?
			check_variable = { max_index_1_tmp = max_index_2_tmp }
		}
		set_variable = { POTEF_elect = max_index_2_tmp }
		### three-year term
		set_variable = { POTEF_term = 1095 } #1095
	}
	else_if = {
		limit = {
			relative_majority_member_states = yes
			relative_majority_popular_vote = yes
			#identical?
			check_variable = { max_index_1_tmp = max_index_2_tmp }
		}
		set_variable = { POTEF_elect = max_index_2_tmp }
		### two-year term
		set_variable = { POTEF_term = 730 } #730
	}
	else_if = {
		limit = {
			relative_majority_popular_vote = yes
		}
		set_variable = { POTEF_elect = max_index_2_tmp }
		### one-year term
		set_variable = { POTEF_term = 365 }	#365
	}

	set_variable = { POTEF_time_to_camp = POTEF_term }
	subtract_from_variable = { POTEF_time_to_camp = camp_time }
	set_variable = { POTEF_years = POTEF_term }
	divide_variable = { POTEF_years = 365 }

	meta_effect = {
		text = {
			every_country = {
				limit = {
					has_idea = EU_member
					has_country_flag = POTEF_nominee_[subideology]
				}
				set_temp_variable = { potef_term_temp = PREV.POTEF_term }

				# Set the President of the European Federation
				add_timed_idea = {
					idea = EU_president
					days = potef_term_temp
				}
				set_variable = { global.eupresfederation = THIS.id }

				activate_mission = EU_POTEF_term
				news_event = EU_POTEF_news.2
			}
		}
		subideology = "[?POTEF_elect|0]"
	}

	# End Configuration
	force_update_map_mode = { mapmode = EU_map_mode }
	clear_potef_electoral_values = yes
	update_eu_dirty_variable = yes
}

clear_potef_electoral_values = {
	for_each_scope_loop = {
		array = global.EU_member
		clr_country_flag = POTEF_nominee_0
		clr_country_flag = POTEF_nominee_1
		clr_country_flag = POTEF_nominee_2
		clr_country_flag = POTEF_nominee_3
		clr_country_flag = POTEF_nominee_4
		clr_country_flag = POTEF_nominee_5
		clr_country_flag = POTEF_nominee_6
		clr_country_flag = POTEF_nominee_7
		clr_country_flag = POTEF_nominee_8
		clr_country_flag = POTEF_nominee_9
		clr_country_flag = POTEF_nominee_10
		clr_country_flag = POTEF_nominee_11
		clr_country_flag = POTEF_nominee_12
		clr_country_flag = POTEF_nominee_13
		clr_country_flag = POTEF_nominee_14
		clr_country_flag = POTEF_nominee_15
		clr_country_flag = POTEF_nominee_16
		clr_country_flag = POTEF_nominee_17
		clr_country_flag = POTEF_nominee_18
		clr_country_flag = POTEF_nominee_19
		clr_country_flag = POTEF_nominee_20
		clr_country_flag = POTEF_nominee_21
		clr_country_flag = POTEF_nominee_22
		clr_country_flag = POTEF_nominee_23
	}
	clr_global_flag = ongoing_potef_election
	clear_variable = global.var_POTEF_nominee_0
	clear_variable = global.var_POTEF_nominee_1
	clear_variable = global.var_POTEF_nominee_2
	clear_variable = global.var_POTEF_nominee_3
	clear_variable = global.var_POTEF_nominee_4
	clear_variable = global.var_POTEF_nominee_5
	clear_variable = global.var_POTEF_nominee_6
	clear_variable = global.var_POTEF_nominee_7
	clear_variable = global.var_POTEF_nominee_8
	clear_variable = global.var_POTEF_nominee_9
	clear_variable = global.var_POTEF_nominee_10
	clear_variable = global.var_POTEF_nominee_11
	clear_variable = global.var_POTEF_nominee_12
	clear_variable = global.var_POTEF_nominee_13
	clear_variable = global.var_POTEF_nominee_14
	clear_variable = global.var_POTEF_nominee_15
	clear_variable = global.var_POTEF_nominee_16
	clear_variable = global.var_POTEF_nominee_17
	clear_variable = global.var_POTEF_nominee_18
	clear_variable = global.var_POTEF_nominee_19
	clear_variable = global.var_POTEF_nominee_20
	clear_variable = global.var_POTEF_nominee_21
	clear_variable = global.var_POTEF_nominee_22
	clear_variable = global.var_POTEF_nominee_23
}

update_EU_average_gdpc_lvl = { # For calcuations that don't have set_EU_gdp
	set_variable = { global.EU_gdp_capita = 0 }
	for_each_scope_loop = {
		array = global.EU_member
		add_to_variable = { global.EU_gdp_capita = THIS.gdp_total}
	}
	divide_variable = { global.EU_gdp_capita = global.var_EUpopTotalDisplay }
	update_eu_dirty_variable = yes
}

update_EU_average_eco_lvl = {
	set_variable = { global.EU_average_eco_lvl = 0 }
	for_each_scope_loop = {
		array = global.EU_member
		if = { limit = { has_idea = economic_boom }
			set_variable = { EU_average_eco_lvl = 6 }
			add_to_variable = { global.EU_average_eco_lvl = 6 }
		}
		else_if = { limit = { has_idea = fast_growth }
			set_variable = { EU_average_eco_lvl = 5 }
			add_to_variable = { global.EU_average_eco_lvl = EU_average_eco_lvl }
		}
		else_if = { limit = { has_idea = stable_growth }
			set_variable = { EU_average_eco_lvl = 4 }
			add_to_variable = { global.EU_average_eco_lvl = EU_average_eco_lvl }
		}
		else_if = { limit = { has_idea = stagnation }
			set_variable = { EU_average_eco_lvl = 3 }
			add_to_variable = { global.EU_average_eco_lvl = EU_average_eco_lvl }
		}
		else_if = { limit = { has_idea = recession }
			set_variable = { EU_average_eco_lvl = 2 }
			add_to_variable = { global.EU_average_eco_lvl = EU_average_eco_lvl }
		}
		else_if = { limit = { has_idea = depression }
			set_variable = { EU_average_eco_lvl = 1 }
			add_to_variable = { global.EU_average_eco_lvl = EU_average_eco_lvl }
		}
	}
	divide_variable = { global.EU_average_eco_lvl = global.EU_member_count }
	update_eu_dirty_variable = yes
}

set_EU_gdp = {
	# Calculate the EU Total GDP
	set_variable = { global.EU_gdp = 0 }
	set_temp_variable = { temp_calc = 0 }
	for_each_scope_loop = {
		array = global.EU_member
		add_to_variable = { global.EU_gdp = THIS.gdp_total } #This value is for display purposes
		add_to_temp_variable = { temp_calc = gdp_total } #This is for the GDP/C
	}

	# Calculate the individual ratio of GDP per nation
	for_each_scope_loop = {
		array = global.EU_member

		set_temp_variable = { temp_ratio = THIS.gdp_total }
		divide_temp_variable = { temp_ratio = global.EU_gdp }
		set_variable = { EU_ratio_of_total_eu_gdp = temp_ratio }
	}

	# Calculate the EU GDP/C
	update_EU_average_gdpc_lvl = yes

	update_eu_dirty_variable = yes
}

EU_save_budget_values = {
	set_variable = { global.EU_global_exp_saved = global.EU_global_exp_ratio }
	set_variable = { global.EU_growth_exp_saved = global.EU_growth_exp_ratio }
	set_variable = { global.EU_natural_exp_saved = global.EU_natural_exp_ratio }
}

EU_save_mff_values = {
	set_variable = { global.EU_min_call_rate_saved = global.EU_budget_min_call_rate }
	set_variable = { global.EU_global_call_rate_saved = global.EU_budget_call_rate }
	for_each_scope_loop = {
		array = global.EU_member
		set_variable = { THIS.EU_call_rate_saved = THIS.EU_budget_call_rate }
	}
}

EU_rollback_budget_values = {
	set_variable = { global.EU_global_exp_ratio = global.EU_global_exp_saved }
	set_variable = { global.EU_growth_exp_ratio = global.EU_growth_exp_saved}
	set_variable = { global.EU_natural_exp_ratio = global.EU_natural_exp_saved }
	distribute_EU_budget = yes
}

EU_rollback_mff_values = {
	set_variable = { global.EU_budget_min_call_rate = global.EU_min_call_rate_saved }
	set_variable = { global.EU_budget_call_rate = global.EU_global_call_rate_saved }
	for_each_scope_loop = {
		array = global.EU_member
		set_variable = { THIS.EU_budget_call_rate = THIS.EU_call_rate_saved }
		update_EU_budget_call_rate = yes
		distribute_EU_budget = yes
	}
}

update_EU_budget_call_rate = {
	set_variable = { global.EU_total_budget = 0 }
	### member state contribution
	for_each_scope_loop = {
		array = global.EU_member
		set_variable = { THIS.EU_budget_contribution = THIS.gdp_total }
		multiply_variable = { THIS.EU_budget_contribution = THIS.EU_budget_call_rate }
		divide_variable = { THIS.EU_budget_contribution = 100 }
		add_to_variable = { global.EU_total_budget = THIS.EU_budget_contribution }
	}
	for_each_scope_loop = { # Needs to be seperate for the total budget to sum up first
		array = global.EU_member
		set_variable = { THIS.EU_budget_ratio = THIS.EU_budget_contribution }
		set_variable = { THIS.EU_budget_contribution_weekly = THIS.EU_budget_contribution }
		divide_variable = { THIS.EU_budget_contribution_weekly = 52 } #Weeks in a year
		divide_variable = { THIS.EU_budget_ratio = global.EU_total_budget }
	}
	### EU Total Budget
	set_variable = { global.EU_mff_total = global.EU_total_budget }
	multiply_variable = { global.EU_mff_total = 5 }

	update_eu_dirty_variable = yes
}

EU_global_click_cost = {
	set_variable = { global.EU_10_per_member_cost = 10 }
	multiply_variable = { global.EU_10_per_member_cost = global.EU_member_count }
	set_variable = { global.EU_10_per_member_cost_minus = global.EU_10_per_member_cost }		
	multiply_variable = { global.EU_10_per_member_cost_minus = -1 }
	set_variable = { global.EU_15_per_member_cost = 15 }
	multiply_variable = { global.EU_15_per_member_cost = global.EU_member_count }
	set_variable = { global.EU_15_per_member_cost_minus = global.EU_15_per_member_cost }
	multiply_variable = { global.EU_15_per_member_cost_minus = -1 }
}

EU_country_call_rate_cost_calc = {
	for_each_scope_loop = {
		array = global.EU_member
		set_variable = { THIS.EU_mff_country_cost = 1000 }
		multiply_variable = { THIS.EU_mff_country_cost = THIS.EU_budget_ratio }
		set_variable = { THIS.EU_mff_country_cost_minus = THIS.EU_mff_country_cost }
		multiply_variable = { THIS.EU_mff_country_cost_minus = -1 }
	}
}

set_EU_expenditure = {
	set_variable = { global.EU_total_exp = global.EU_total_budget }
	set_variable = { global.EU_growth_exp_ratio = 0.44 }
	set_variable = { global.EU_natural_exp_ratio = 0.44 }
	set_variable = { global.EU_global_exp_ratio = 0.06 }
	set_variable = { global.EU_admin_exp_ratio = 0.06 }
	set_variable = { global.EU_growth_exp_total = global.EU_growth_exp_ratio }
	set_variable = { global.EU_natural_exp_total = global.EU_natural_exp_ratio }
	set_variable = { global.EU_global_exp_total = global.EU_global_exp_ratio }
	set_variable = { global.EU_admin_exp_total = global.EU_admin_exp_ratio }

	multiply_variable = { global.EU_growth_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_natural_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_global_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_admin_exp_total = global.EU_total_exp }
	update_eu_dirty_variable = yes
}

update_EU_expenditure = {
	set_variable = { global.EU_growth_exp_total = global.EU_growth_exp_ratio }
	set_variable = { global.EU_natural_exp_total = global.EU_natural_exp_ratio }
	set_variable = { global.EU_global_exp_total = global.EU_global_exp_ratio }
	set_variable = { global.EU_admin_exp_total = global.EU_admin_exp_ratio }

	multiply_variable = { global.EU_growth_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_natural_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_global_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_admin_exp_total = global.EU_total_exp }
	update_eu_dirty_variable = yes
}


distribute_EU_budget = {
	distribute_EU_growth_exp = yes
	distribute_EU_natural_exp = yes
	### distribute_EU_global_exp
	for_each_scope_loop = {
		array = global.EU_member
		if = {
			limit = { is_leader_of_EU_foreign_policy = yes }
			set_variable = { EU_global_exp_subsidies = global.EU_global_exp_total }
		}
	}
	distribute_EU_admin_exp = yes
	EU_budget_total_gain = yes
	update_eu_dirty_variable = yes
}

distribute_EU_growth_exp = {
	set_variable = { global.EU_growth_subsidies_total = 0 }
	for_each_scope_loop = {
		array = global.EU_member
		if = { limit = { has_idea = economic_boom }
			set_variable = { THIS.EU_growth_subsidies = 1 }
			multiply_variable = { THIS.EU_growth_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_growth_subsidies_total = THIS.EU_growth_subsidies }
		}
		else_if = { limit = { has_idea = fast_growth }
			set_variable = { THIS.EU_growth_subsidies = 2 }
			multiply_variable = { THIS.EU_growth_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_growth_subsidies_total = THIS.EU_growth_subsidies }
		}
		else_if = { limit = { has_idea = stable_growth }
			set_variable = { THIS.EU_growth_subsidies = 3 }
			multiply_variable = { THIS.EU_growth_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_growth_subsidies_total = THIS.EU_growth_subsidies }
		}
		else_if = { limit = { has_idea = stagnation }
			set_variable = { THIS.EU_growth_subsidies = 4 }
			multiply_variable = { THIS.EU_growth_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_growth_subsidies_total = THIS.EU_growth_subsidies }
		}
		else_if = { limit = { has_idea = recession }
			set_variable = { THIS.EU_growth_subsidies = 5 }
			multiply_variable = { THIS.EU_growth_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_growth_subsidies_total = THIS.EU_growth_subsidies }
		}
		else_if = { limit = { has_idea = depression }
			set_variable = { THIS.EU_growth_subsidies = 6 }
			multiply_variable = { THIS.EU_growth_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_growth_subsidies_total = THIS.EU_growth_subsidies }
		}
	}
	for_each_scope_loop = {
		array = global.EU_member
		divide_variable = { THIS.EU_growth_subsidies = global.EU_growth_subsidies_total }
		multiply_variable = { THIS.EU_growth_subsidies = global.EU_growth_exp_total }
	}
	update_eu_dirty_variable = yes
}

distribute_EU_natural_exp = {
	set_variable = { global.EU_natural_subsidies_total = 0 }
	for_each_scope_loop = {
		array = global.EU_member
		if = { limit = { check_variable = { gdp_per_capita > 199.999 } }
			set_variable = { THIS.EU_natural_subsidies = 1 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
		else_if = {
			limit = {
				check_variable = { gdp_per_capita < 200.000 }
				check_variable = { gdp_per_capita > 139.999 }
			}
			set_variable = { THIS.EU_natural_subsidies = 2 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
		else_if = {
			limit = {
				check_variable = { gdp_per_capita < 140.000 }
				check_variable = { gdp_per_capita > 89.999 }
			}
			set_variable = { THIS.EU_natural_subsidies = 3 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
		else_if = {
			limit = {
				check_variable = { gdp_per_capita < 90.000 }
				check_variable = { gdp_per_capita > 49.999 }
			}
			set_variable = { THIS.EU_natural_subsidies = 4 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
		else_if = {
			limit = {
				check_variable = { gdp_per_capita < 50.000 }
				check_variable = { gdp_per_capita > 29.999 }
			}
			set_variable = { THIS.EU_natural_subsidies = 5 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
		else_if = {
			limit = {
				check_variable = { gdp_per_capita < 30.000 }
				check_variable = { gdp_per_capita > 19.999 }
			}
			set_variable = { THIS.EU_natural_subsidies = 6 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
		else_if = {
			limit = {
				check_variable = { gdp_per_capita < 20.000 }
				check_variable = { gdp_per_capita > 14.999 }
			}
			set_variable = { THIS.EU_natural_subsidies = 7 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
		else_if = {
			limit = {
				check_variable = { gdp_per_capita < 15.000 }
				check_variable = { gdp_per_capita > 9.999 }
			}
			set_variable = { THIS.EU_natural_subsidies = 8 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
		else_if = {
			limit = {
				check_variable = { gdp_per_capita < 10.000 }
				check_variable = { gdp_per_capita > 6.999 }
			}
			set_variable = { THIS.EU_natural_subsidies = 9 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
		else_if = {
			limit = {
				check_variable = { gdp_per_capita < 7.000 }
				check_variable = { gdp_per_capita > 3.999 }
			}
			set_variable = { THIS.EU_natural_subsidies = 10 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
		else_if = {
			limit = {
				check_variable = { gdp_per_capita < 4.000 }
				check_variable = { gdp_per_capita > 1.999 }
			}
			set_variable = { THIS.EU_natural_subsidies = 11 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
		else_if = {
			limit = {
				check_variable = { gdp_per_capita < 2.00 }
			}
			set_variable = { THIS.EU_natural_subsidies = 12 }
			multiply_variable = { THIS.EU_natural_subsidies = THIS.EU_pop_ratio }
			add_to_variable = { global.EU_natural_subsidies_total = THIS.EU_natural_subsidies }
		}
	}
	for_each_scope_loop = {
		array = global.EU_member
		divide_variable = { THIS.EU_natural_subsidies = global.EU_natural_subsidies_total }
		multiply_variable = { THIS.EU_natural_subsidies = global.EU_natural_exp_total }
	}
	update_eu_dirty_variable = yes
}


distribute_EU_admin_exp = {
	if = {
		limit = {
			any_of_scopes = {
				array = global.EU_member
				has_idea = frontex_ExDir
			}
			any_of_scopes = {
				array = global.EU_member
				has_idea = EU_commission_president
			}
		}
		for_each_scope_loop = {
			array = global.EU_member
			if = { limit = { has_idea = frontex_ExDir }
				set_variable = { THIS.EU_admin_subsidies = 0.5 }
				multiply_variable = { THIS.EU_admin_subsidies = global.EU_admin_exp_total }
			}
			if = { limit = { has_idea = EU_commission_president }
				set_variable = { THIS.EU_admin_subsidies = 0.5 }
				multiply_variable = { THIS.EU_admin_subsidies = global.EU_admin_exp_total }
			}
		}
	}
	else_if = {
		limit = {
			any_of_scopes = {
				array = global.EU_member
				has_idea = frontex_ExDir
			}
			NOT = {
				any_of_scopes = {
					array = global.EU_member
					has_idea = EU_commission_president
				}
			}
		}
		for_each_scope_loop = {
			array = global.EU_member
			if = { limit = { has_idea = frontex_ExDir }
				set_variable = { THIS.EU_admin_subsidies = global.EU_admin_exp_total }
			}
		}
	}
	else_if = {
		limit = {
			NOT = {
				any_of_scopes = { array = global.EU_member has_idea = frontex_ExDir }
			}
			any_of_scopes = {
				array = global.EU_member
				has_idea = EU_commission_president
			}
		}
		for_each_scope_loop = {
			array = global.EU_member
			if = { limit = { has_idea = EU_commission_president }
				set_variable = { THIS.EU_admin_subsidies = global.EU_admin_exp_total }
			}
		}
	}
	update_eu_dirty_variable = yes
}

EU_budget_total_gain = {
	for_each_scope_loop = {
		array = global.EU_member
		set_variable = { THIS.EU_budget_total_gain = 0 }
		add_to_variable = { THIS.EU_budget_total_gain = THIS.EU_growth_subsidies }
		add_to_variable = { THIS.EU_budget_total_gain = THIS.EU_natural_subsidies }
		add_to_variable = { THIS.EU_budget_total_gain = THIS.EU_global_exp_subsidies }
		add_to_variable = { THIS.EU_budget_total_gain = THIS.EU_admin_subsidies }
		set_variable = { THIS.EU_budget_ratio_gain = THIS.EU_budget_total_gain }
		divide_variable = { THIS.EU_budget_ratio_gain = global.EU_total_exp }
		set_variable = { THIS.EU_budget_net = THIS.EU_budget_total_gain }
		subtract_from_variable = { THIS.EU_budget_net = THIS.EU_budget_contribution }
	}
	update_eu_dirty_variable = yes
}

######################
######################
### EU Parliament ####
######################
######################
clear_EU_Parliament_MEP_THIS = {
	### clear MEP vars
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { MEP_number = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				clear_variable = THIS.MEP_party_[MEP_n]
			}
			MEP_n = "[?MEP_number]"
		}
	}
	update_eu_dirty_variable = yes
}

clear_EU_Parliament = {
	### EU Parliament global flags
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { PG_party_number = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				clr_global_flag = EU_parl_PG_party_[PG_p_n]
			}
			PG_p_n = "[?PG_party_number]"
		}
	}
	### EU Parliament global vars
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { MEP_PG_number = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				clear_variable = global.MEP_PG_party_[MEP_PG_n]
			}
			MEP_PG_n = "[?MEP_PG_number]"
		}
	}
	#
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { MEP_Ratio_number = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				clear_variable = global.MEP_Ratio_PG_party_[MEP_Ratio_n]
			}
			MEP_Ratio_n = "[?MEP_Ratio_number]"
		}
	}
	#
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { PI_PG_number = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				clear_variable = global.PI_PG_party_[PI_PG_n]
			}
			PI_PG_n = "[?PI_PG_number]"
		}
	}

	for_each_scope_loop = {
		array = global.EU_potential
		clear_EU_Parliament_MEP_THIS = yes
	}

	clear_variable = global.MEP_Total
	clear_variable = global.MEP_Majority
	update_eu_dirty_variable = yes
}

election_EU_Parliament = {

	# set max MEPs
	if = {
		limit = {
			focus_EU651_accepted = yes 
			focus_EU104_accepted = yes 
		}
		set_variable = { global.EU_Parliament_max_MEP = 1000 }
	}
	else_if = {
		limit = {
			NOT = { focus_EU651_accepted = yes }
			focus_EU104_accepted = yes
		}
		set_variable = { global.EU_Parliament_max_MEP = 750 }
	}
	else = { set_variable = { global.EU_Parliament_max_MEP = 732 } }

	# set MEP clamps for countries
	if = {
		limit = {
			focus_EU651_accepted = yes
			focus_EU104_accepted = yes
		}
		set_variable = { global.min_clamp_eu_mep = 8 }
	}
	else_if = {
		limit = { 
			NOT = { focus_EU651_accepted = yes }
			focus_EU104_accepted = yes 
		}
		set_variable = { global.min_clamp_eu_mep = 6 }
	}
	else_if = {
		limit = { 
			NOT = { focus_EU651_accepted = yes }
			NOT = { focus_EU104_accepted = yes }
		}
		set_variable = { global.min_clamp_eu_mep = 5 }
	}
	if = {
		limit = {
			focus_EU651_accepted = yes
			focus_EU104_accepted = yes
		}
		set_variable = { global.max_clamp_eu_mep = 100 }
	}
	else_if = {
		limit = { 
			NOT = { focus_EU651_accepted = yes }
			focus_EU104_accepted = yes 
		}
		set_variable = { global.max_clamp_eu_mep = 96 }
	}
	else_if = {
		limit = { 
			NOT = { focus_EU651_accepted = yes }
			NOT = { focus_EU104_accepted = yes }
		}
		set_variable = { global.max_clamp_eu_mep = 99 }
	}
	
	### Election in member_state
	for_each_scope_loop = {
		array = global.EU_member
		election_EU_Parliament_in_member_state = yes
	}

	set_variable = { global.MEP_Total = 0 } # Recalculate to account for roundings
	for_each_scope_loop = {
		array = global.EU_member
		add_to_variable = { global.MEP_Total = THIS.MEP_Total }
	}

	### check political groups
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { p_number = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				set_global_flag = EU_parl_PG_party_[p_n]
				set_variable = { global.MEP_Ratio_PG_party_[p_n] = global.MEP_PG_party_[p_n] }
				divide_variable = { global.MEP_Ratio_PG_party_[p_n] = global.MEP_Total }
				add_to_array = { global.MEP_PG_array^[p_n] = global.MEP_PG_party_[p_n] }
			}
			p_n = "[?p_number]"
		}
	}
	
	set_variable = { global.MEP_Total = 0 } # Recalculate to account for more roundings
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { p_number2 = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				add_to_variable = { global.MEP_Total = global.MEP_PG_party_[p_n2] }
			}
			p_n2 = "[?p_number2]"
		}
	}

	set_variable = { global.MEP_Majority = global.MEP_Total }
	divide_variable = { global.MEP_Majority = 2 }
	add_to_variable = { global.MEP_Majority = 1 }
	
}

election_EU_Parliament_in_member_state = {
	###  MEP for this member state
	set_temp_variable = { temp1 = global.EU_Parliament_max_MEP }
	multiply_temp_variable = { temp1 = THIS.EU_pop_ratio }
	round_temp_variable = temp1
	clamp_temp_variable = { 
		var = temp1
		min = global.min_clamp_eu_mep
		max = global.max_clamp_eu_mep
	}
	set_variable = { THIS.MEP_Total = temp1 }
	set_variable = { THIS.MEP_Total_target = THIS.MEP_Total }
	### MEP per subideology
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { p_number3 = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				set_variable = { THIS.MEP_party_[p_n3] = party_pop_array^[p_n3] }
				multiply_variable = { THIS.MEP_party_[p_n3] = THIS.MEP_Total }
				round_variable = THIS.MEP_party_[p_n3]
			}
			p_n3 = "[?p_number3]"
		}
	}
	set_variable = { THIS.MEP_Total = 0 }
	### MEP per subideology # Recalc for roundings
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { p_number4 = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				add_to_variable = { THIS.MEP_Total = THIS.MEP_party_[p_n4] }
				add_to_array = { THIS.MEP_party_array = THIS.MEP_party_[p_n4] }
			}
			p_n4 = "[?p_number4]"
		}
	}

	set_temp_variable = { value_temp = 0 }
	set_temp_variable = { index_temp = 0 }

	find_highest_in_array = {
		array = THIS.MEP_party_array
		value = value_temp
		index = index_temp
	}
	set_variable = { THIS.highest_MEP_party_value = value_temp }
	set_variable = { THIS.highest_MEP_party_index = index_temp }
	set_variable = { THIS.var77 = THIS.highest_MEP_party_value }

	if = {
		limit = { NOT = { check_variable = { THIS.MEP_Total_target = THIS.MEP_Total } } }

		meta_effect = {
			text = {
				if = {
					limit = { check_variable = { THIS.MEP_Total > THIS.MEP_Total_target } }
					set_temp_variable = { subtraction_value = THIS.MEP_Total }
					subtract_from_temp_variable = { subtraction_value = THIS.MEP_Total_target }
					subtract_from_variable = { THIS.MEP_party_[highest_index_meta] = subtraction_value }
				}
				else_if = {
					limit = { check_variable = { THIS.MEP_Total < THIS.MEP_Total_target } }
					set_temp_variable = { addition_value = THIS.MEP_Total_target }
					subtract_from_temp_variable = { addition_value = THIS.MEP_Total }
					add_to_variable = { THIS.MEP_party_[highest_index_meta] = addition_value }
				}
			}
			highest_index_meta = "[?THIS.highest_MEP_party_index]"
		}
	}

	set_temp_variable = { value_temp = 0 }
	set_temp_variable = { index_temp = 0 }

	### Recalc total
	set_variable = { THIS.MEP_Total = 0 }
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { p_number5 = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				add_to_variable = { THIS.MEP_Total = THIS.MEP_party_[p_n5] }
			}
			p_n5 = "[?p_number5]"
		}
	}
	### Recalc PG
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { p_number6 = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				add_to_variable = { global.MEP_PG_party_[p_n6] = THIS.MEP_party_[p_n6] }
			}
			p_n6 = "[?p_number6]"
		}
	}
	
	update_eu_dirty_variable = yes
}

#################################
### EU Parliament legislation ###
#################################
set_ruling_party_PG_support = {
	log = "[GetDateText]: [THIS.GetName]: set_ruling_party_PG_support"
	set_temp_variable = { indexed_addition = 0 }

	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { rp_PG_number = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				if = { limit = { is_in_array = { ruling_party = [rp_PG_n] } }
					set_global_flag = global.PG_party_[rp_PG_n]_support
					set_temp_variable = { indexed_addition = global.MEP_PG_party_[rp_PG_n] }
				}
			}
			rp_PG_n = "[?rp_PG_number]"
		}
	}

	set_variable = { global.active_MEP_Support = indexed_addition }
	meta_effect = {
		text = {
			set_variable = { global.focus_[EUXXX]_MEP_support = indexed_addition }
		}
		EUXXX = "[EUXXX_EP_agenda]"
	}
	update_eu_dirty_variable = yes
}

reset_MEP_support_party_x = {
	set_variable = { global.EU_draft_party_0_variable = 0 }
	set_variable = { global.EU_draft_party_1_variable = 0 }
	set_variable = { global.EU_draft_party_2_variable = 0 }
	set_variable = { global.EU_draft_party_3_variable = 0 }
	set_variable = { global.EU_draft_party_4_variable = 0 }
	set_variable = { global.EU_draft_party_5_variable = 0 }
	set_variable = { global.EU_draft_party_6_variable = 0 }
	set_variable = { global.EU_draft_party_7_variable = 0 }
	set_variable = { global.EU_draft_party_8_variable = 0 }
	set_variable = { global.EU_draft_party_9_variable = 0 }
	set_variable = { global.EU_draft_party_10_variable = 0 }
	set_variable = { global.EU_draft_party_11_variable = 0 }
	set_variable = { global.EU_draft_party_12_variable = 0 }
	set_variable = { global.EU_draft_party_13_variable = 0 }
	set_variable = { global.EU_draft_party_14_variable = 0 }
	set_variable = { global.EU_draft_party_15_variable = 0 }
	set_variable = { global.EU_draft_party_16_variable = 0 }
	set_variable = { global.EU_draft_party_17_variable = 0 }
	set_variable = { global.EU_draft_party_18_variable = 0 }
	set_variable = { global.EU_draft_party_19_variable = 0 }
	set_variable = { global.EU_draft_party_20_variable = 0 }
	set_variable = { global.EU_draft_party_21_variable = 0 }
	set_variable = { global.EU_draft_party_22_variable = 0 }
	set_variable = { global.EU_draft_party_23_variable = 0 }
}

all_MEP_support_draft = {
	set_variable = { global.EU_draft_party_0_variable = 10 }
	set_variable = { global.EU_draft_party_1_variable = 10 }
	set_variable = { global.EU_draft_party_2_variable = 10 }
	set_variable = { global.EU_draft_party_3_variable = 10 }
	set_variable = { global.EU_draft_party_4_variable = 10 }
	set_variable = { global.EU_draft_party_5_variable = 10 }
	set_variable = { global.EU_draft_party_6_variable = 10 }
	set_variable = { global.EU_draft_party_7_variable = 10 }
	set_variable = { global.EU_draft_party_8_variable = 10 }
	set_variable = { global.EU_draft_party_9_variable = 10 }
	set_variable = { global.EU_draft_party_10_variable = 10 }
	set_variable = { global.EU_draft_party_11_variable = 10 }
	set_variable = { global.EU_draft_party_12_variable = 10 }
	set_variable = { global.EU_draft_party_13_variable = 10 }
	set_variable = { global.EU_draft_party_14_variable = 10 }
	set_variable = { global.EU_draft_party_15_variable = 10 }
	set_variable = { global.EU_draft_party_16_variable = 10 }
	set_variable = { global.EU_draft_party_17_variable = 10 }
	set_variable = { global.EU_draft_party_18_variable = 10 }
	set_variable = { global.EU_draft_party_19_variable = 10 }
	set_variable = { global.EU_draft_party_20_variable = 10 }
	set_variable = { global.EU_draft_party_21_variable = 10 }
	set_variable = { global.EU_draft_party_22_variable = 10 }
	set_variable = { global.EU_draft_party_23_variable = 10 }
}

assess_MEP_support_party_x = {
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { MEP_sup_number = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				if = {
					limit = { check_variable = { global.EU_draft_party_[MEP_sup_n]_variable > 0 } }
					set_global_flag = global.PG_party_[MEP_sup_n]_support
					add_to_variable = { global.active_MEP_Support = global.MEP_PG_party_[MEP_sup_n] }
				}
			}
			MEP_sup_n = "[?MEP_sup_number]"
		}
	}
	update_eu_dirty_variable = yes
}

####################################
### clr_global_flag_PG_X_support ###
####################################

clr_global_flag_PG_X_support = {
	for_each_loop = {
		array = global.EU_parl_party_number
		set_variable = { PG_ps_number = global.EU_parl_party_number^i }

		meta_effect = {
			text = {
				clr_global_flag = global.PG_party_[PG_ps_n]_support
			}
			PG_ps_n = "[?PG_ps_number]"
		}
	}
	update_eu_dirty_variable = yes
}


###############################
### EU POTEF dynmod effects ###
###############################

update_POTEF_army_infantry_defence_factor = {
	custom_effect_tooltip = POTEF_army_infantry_defence_factor_tt
	add_to_variable = { POTEF_army_infantry_defence_factor = POTEF_army_infantry_defence_factor_change }
}
update_POTEF_terrain_penalty_reduction = {
	custom_effect_tooltip = POTEF_terrain_penalty_reduction_tt
	add_to_variable = { POTEF_terrain_penalty_reduction = POTEF_terrain_penalty_reduction_change }
}
update_POTEF_army_armor_attack_factor = {
	custom_effect_tooltip = POTEF_army_armor_attack_factor_tt
	add_to_variable = { POTEF_army_armor_attack_factor = POTEF_army_armor_attack_factor_change }
}
update_POTEF_army_armor_speed_factor = {
	custom_effect_tooltip = POTEF_army_armor_speed_factor_tt
	add_to_variable = { POTEF_army_armor_speed_factor = POTEF_army_armor_speed_factor_change }
}
update_POTEF_army_armor_defence_factor = {
	custom_effect_tooltip = POTEF_army_armor_defence_factor_tt
	add_to_variable = { POTEF_army_armor_defence_factor = POTEF_army_armor_defence_factor_change }
}
update_POTEF_recon_factor = {
	custom_effect_tooltip = POTEF_recon_factor_tt
	add_to_variable = { POTEF_recon_factor = POTEF_recon_factor_change }
}
update_POTEF_river_crossing_factor = {
	custom_effect_tooltip = POTEF_river_crossing_factor_tt
	add_to_variable = { POTEF_river_crossing_factor = POTEF_river_crossing_factor_change }
}
update_POTEF_paradrop_organization_factor = {
	custom_effect_tooltip = POTEF_paradrop_organization_factor_tt
	add_to_variable = { POTEF_paradrop_organization_factor = POTEF_paradrop_organization_factor_change }
}
update_POTEF_extra_paratrooper_supply_grace = {
	custom_effect_tooltip = POTEF_extra_paratrooper_supply_grace_tt
	add_to_variable = { POTEF_extra_paratrooper_supply_grace = POTEF_extra_paratrooper_supply_grace_change }
}
update_POTEF_experience_gain_navy = {
	custom_effect_tooltip = POTEF_experience_gain_navy_tt
	add_to_variable = { POTEF_experience_gain_navy = POTEF_experience_gain_navy_change }
}
update_POTEF_experience_gain_navy_factor = {
	custom_effect_tooltip = POTEF_experience_gain_navy_factor_tt
	add_to_variable = { POTEF_experience_gain_navy_factor = POTEF_experience_gain_navy_factor_change }
}
update_POTEF_navy_org_factor = {
	custom_effect_tooltip = POTEF_navy_org_factor_tt
	add_to_variable = { POTEF_navy_org_factor = POTEF_navy_org_factor_change }
}
update_POTEF_army_intel_factor = {
	custom_effect_tooltip = POTEF_army_intel_factor_tt
	add_to_variable = { POTEF_army_intel_factor = POTEF_army_intel_factor_change }
}
update_POTEF_navy_intel_factor = {
	custom_effect_tooltip = POTEF_navy_intel_factor_tt
	add_to_variable = { POTEF_navy_intel_factor = POTEF_navy_intel_factor_change }
}
update_POTEF_airforce_intel_factor = {
	custom_effect_tooltip = POTEF_airforce_intel_factor_tt
	add_to_variable = { POTEF_airforce_intel_factor = POTEF_airforce_intel_factor_change }
}
update_POTEF_winter_attrition_factor = {
	custom_effect_tooltip = POTEF_winter_attrition_factor_tt
	add_to_variable = { POTEF_winter_attrition_factor = POTEF_winter_attrition_factor_change }
}
update_POTEF_acclimatization_cold_climate_gain_factor = {
	custom_effect_tooltip = POTEF_acclimatization_cold_climate_gain_factor_tt
	add_to_variable = { POTEF_acclimatization_cold_climate_gain_factor = POTEF_acclimatization_cold_climate_gain_factor_change }
}
update_POTEF_mechanized_attack_factor = {
	custom_effect_tooltip = POTEF_mechanized_attack_factor_tt
	add_to_variable = { POTEF_mechanized_attack_factor = POTEF_mechanized_attack_factor_change }
}
update_POTEF_mechanized_defence_factor = {
	custom_effect_tooltip = POTEF_mechanized_defence_factor_tt
	add_to_variable = { POTEF_mechanized_defence_factor = POTEF_mechanized_defence_factor_change }
}
update_POTEF_motorized_attack_factor = {
	custom_effect_tooltip = POTEF_motorized_attack_factor_tt
	add_to_variable = { POTEF_motorized_attack_factor = POTEF_motorized_attack_factor_change }
}
update_POTEF_motorized_defence_factor = {
	custom_effect_tooltip = POTEF_motorized_defence_factor_tt
	add_to_variable = { POTEF_motorized_defence_factor = POTEF_motorized_defence_factor_change }
}
update_POTEF_max_planning = {
	custom_effect_tooltip = POTEF_max_planning_tt
	add_to_variable = { POTEF_max_planning = POTEF_max_planning_change }
}
update_POTEF_planning_speed = {
	custom_effect_tooltip = POTEF_planning_speed_tt
	add_to_variable = { POTEF_planning_speed = POTEF_planning_speed_change }
}
update_POTEF_political_power_factor = {
	custom_effect_tooltip = POTEF_political_power_factor_tt
	add_to_variable = { POTEF_political_power_factor = POTEF_political_power_factor_change }
}
update_POTEF_command_power_gain = {
	custom_effect_tooltip = POTEF_command_power_gain_tt
	add_to_variable = { POTEF_command_power_gain = POTEF_command_power_gain_change }
}
update_POTEF_monthly_population = {
	custom_effect_tooltip = POTEF_monthly_population_tt
	add_to_variable = { POTEF_monthly_population = POTEF_monthly_population_change }
}
update_POTEF_war_support_factor = {
	custom_effect_tooltip = POTEF_war_support_factor_tt
	add_to_variable = { POTEF_war_support_factor = POTEF_war_support_factor_change }
}
update_POTEF_trade_opinion_factor = {
	custom_effect_tooltip = POTEF_trade_opinion_factor_tt
	add_to_variable = { POTEF_trade_opinion_factor = POTEF_trade_opinion_factor_change }
}
update_POTEF_opinion_gain_monthly_factor = {
	custom_effect_tooltip = POTEF_opinion_gain_monthly_factor_tt
	add_to_variable = { POTEF_opinion_gain_monthly_factor = POTEF_opinion_gain_monthly_factor_change }
}
update_POTEF_consumer_goods_factor = {
	custom_effect_tooltip = POTEF_consumer_goods_factor_tt
	add_to_variable = { POTEF_consumer_goods_factor = POTEF_consumer_goods_factor_change }
}
update_POTEF_intel_network_gain_factor = {
	custom_effect_tooltip = POTEF_intel_network_gain_factor_tt
	add_to_variable = { POTEF_intel_network_gain_factor = POTEF_intel_network_gain_factor_change }
}
update_POTEF_send_volunteer_size = {
	custom_effect_tooltip = POTEF_send_volunteer_size_tt
	add_to_variable = { POTEF_send_volunteer_size = POTEF_send_volunteer_size_change }
}
update_POTEF_amphibious_invasion = {
	custom_effect_tooltip = POTEF_amphibious_invasion_tt
	add_to_variable = { POTEF_amphibious_invasion = POTEF_amphibious_invasion_change }
}
update_POTEF_amphibious_invasion_defence = {
	custom_effect_tooltip = POTEF_amphibious_invasion_defence_tt
	add_to_variable = { POTEF_amphibious_invasion_defence = POTEF_amphibious_invasion_defence_change }
}
update_POTEF_naval_invasion_penalty = {
	custom_effect_tooltip = POTEF_naval_invasion_penalty_tt
	add_to_variable = { POTEF_naval_invasion_penalty = POTEF_naval_invasion_penalty_change }
}
update_POTEF_naval_invasion_prep_speed = {
	custom_effect_tooltip = POTEF_naval_invasion_prep_speed_tt
	add_to_variable = { POTEF_naval_invasion_prep_speed = POTEF_naval_invasion_prep_speed_change }
}
update_POTEF_naval_invasion_capacity = {
	custom_effect_tooltip = POTEF_naval_invasion_capacity_tt
	add_to_variable = { POTEF_naval_invasion_capacity = POTEF_naval_invasion_capacity_change }
}
update_POTEF_invasion_preparation = {
	custom_effect_tooltip = POTEF_invasion_preparation_tt
	add_to_variable = { POTEF_invasion_preparation = POTEF_invasion_preparation_change }
}
update_POTEF_air_attack_factor = {
	custom_effect_tooltip = POTEF_air_attack_factor_tt
	add_to_variable = { POTEF_air_attack_factor = POTEF_air_attack_factor_change }
}
update_POTEF_cas_damage_reduction = {
	custom_effect_tooltip = POTEF_cas_damage_reduction_tt
	add_to_variable = { POTEF_cas_damage_reduction = POTEF_cas_damage_reduction_change }
}
update_POTEF_army_artillery_attack_factor = {
	custom_effect_tooltip = POTEF_army_artillery_attack_factor_tt
	add_to_variable = { POTEF_army_artillery_attack_factor = POTEF_army_artillery_attack_factor_change }
}
update_POTEF_army_artillery_defence_factor = {
	custom_effect_tooltip = POTEF_army_artillery_defence_factor_tt
	add_to_variable = { POTEF_army_artillery_defence_factor = POTEF_army_artillery_defence_factor_change }
}
update_POTEF_boost_resistance_factor = {
	custom_effect_tooltip = POTEF_boost_resistance_factor_tt
	add_to_variable = { POTEF_boost_resistance_factor = POTEF_boost_resistance_factor_change }
}
update_POTEF_root_out_resistance_effectiveness_factor = {
	custom_effect_tooltip = POTEF_root_out_resistance_effectiveness_factor_tt
	add_to_variable = { POTEF_root_out_resistance_effectiveness_factor = POTEF_root_out_resistance_effectiveness_factor_change }
}
update_POTEF_resistance_damage_to_garrison = {
	custom_effect_tooltip = POTEF_resistance_damage_to_garrison_tt
	add_to_variable = { POTEF_resistance_damage_to_garrison = POTEF_resistance_damage_to_garrison_change }
}
update_POTEF_resistance_target = {
	custom_effect_tooltip =  POTEF_resistance_target_tt
	add_to_variable = { POTEF_resistance_target = POTEF_resistance_target_change }
}
update_POTEF_max_dig_in_factor = {
	custom_effect_tooltip = POTEF_max_dig_in_factor_tt
	add_to_variable = { POTEF_max_dig_in_factor = POTEF_max_dig_in_factor_change }
}
update_POTEF_dig_in_speed_factor = {
	custom_effect_tooltip = POTEF_dig_in_speed_factor_tt
	add_to_variable = { POTEF_dig_in_speed_factor = POTEF_dig_in_speed_factor_change }
}
update_POTEF_defence = {
	custom_effect_tooltip = POTEF_defence_tt
	add_to_variable = { POTEF_defence = POTEF_defence_change }
}
update_POTEF_production_speed_bunker_factor = {
	custom_effect_tooltip = POTEF_production_speed_bunker_factor_tt
	add_to_variable = { POTEF_production_speed_bunker_factor = POTEF_production_speed_bunker_factor_change }
}
update_POTEF_special_forces_attack_factor = {
	custom_effect_tooltip = POTEF_special_forces_attack_factor_tt
	add_to_variable = { POTEF_special_forces_attack_factor = POTEF_special_forces_attack_factor_change }
}
update_POTEF_special_forces_defence_factor = {
	custom_effect_tooltip = POTEF_special_forces_defence_factor_tt
	add_to_variable = { POTEF_special_forces_defence_factor = POTEF_special_forces_defence_factor_change }
}
update_POTEF_special_forces_min = {
	custom_effect_tooltip = POTEF_special_forces_min_tt
	add_to_variable = { POTEF_special_forces_min = POTEF_special_forces_min_change }
}
update_POTEF_special_forces_cap = {
	custom_effect_tooltip = POTEF_special_forces_cap_tt
	add_to_variable = { POTEF_special_forces_cap = POTEF_special_forces_cap_change }
}
update_POTEF_army_infantry_attack_factor = {
	custom_effect_tooltip = POTEF_army_infantry_attack_factor_tt
	add_to_variable = { POTEF_army_infantry_attack_factor = POTEF_army_infantry_attack_factor_change }
}
update_POTEF_army_speed_factor = {
	custom_effect_tooltip = POTEF_army_speed_factor_tt
	add_to_variable = { POTEF_army_speed_factor = POTEF_army_speed_factor_change }
}
update_POTEF_stability_factor = {
	custom_effect_tooltip = POTEF_stability_factor_tt
	add_to_variable = { POTEF_stability_factor = POTEF_stability_factor_change }
}
update_POTEF_research_speed_factor = {
	custom_effect_tooltip = POTEF_research_speed_factor_tt
	add_to_variable = { POTEF_research_speed_factor = POTEF_research_speed_factor_change }
}
