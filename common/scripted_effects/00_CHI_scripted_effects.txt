# set_temp_variable = { modify_uighur_opinion = +- }
CHI_modify_uighur_opinion = {
	add_to_variable = { uighur_opinion = modify_uighur_opinion }
	clamp_variable = {
		var = uighur_opinion
		min = 0
		max = 100
	}
	custom_effect_tooltip = CHI_modify_uighur_opinion_tt
}

# set_temp_variable = { modify_uighur_threat = +- }
CHI_modify_uighur_threat = {
	add_to_variable = { uighur_threat = modify_uighur_threat }
	clamp_variable = {
		var = uighur_threat
		min = 0
		max = 100
	}
	custom_effect_tooltip = CHI_modify_uighur_threat_tt
}

# set_temp_variable = { modify_chinese_aggression = +- }
CHI_modify_chinese_aggression = {
	add_to_variable = { chinese_aggression = modify_chinese_aggression }
	custom_effect_tooltip = CHI_modify_chinese_aggression_tt
}

CHI_water_shortages_increase = {
	if = {
		limit = {
			NOT = {
				has_idea = water_shortages_1
				has_idea = water_shortages_2
				has_idea = water_shortages_3
				has_idea = water_shortages_4
				has_idea = water_shortages_5
			}
		}
		add_ideas = water_shortages_1
	}
	else_if = {
		limit = {
			has_idea = water_shortages_1
		}
		swap_ideas = {
			remove_idea = water_shortages_1
			add_idea = water_shortages_2
		}
	}
	else_if = {
		limit = {
			has_idea = water_shortages_2
		}
		swap_ideas = {
			remove_idea = water_shortages_2
			add_idea = water_shortages_3
		}
	}
	else_if = {
		limit = {
			has_idea = water_shortages_3
		}
		swap_ideas = {
			remove_idea = water_shortages_3
			add_idea = water_shortages_4
		}
	}
	else_if = {
		limit = {
			has_idea = water_shortages_4
		}
		swap_ideas = {
			remove_idea = water_shortages_4
			add_idea = water_shortages_5
		}
	}
}

CHI_water_shortages_decrease = {
	if = {
		limit = { has_idea = water_shortages_1 }
		remove_ideas = water_shortages_1
	}
	else_if = {
		limit = { has_idea = water_shortages_2 }
		swap_ideas = {
			remove_idea = water_shortages_2
			add_idea = water_shortages_1
		}
	}
	else_if = {
		limit = { has_idea = water_shortages_3 }
		swap_ideas = {
			remove_idea = water_shortages_3
			add_idea = water_shortages_2
		}
	}
	else_if = {
		limit = { has_idea = water_shortages_4 }
		swap_ideas = {
			remove_idea = water_shortages_4
			add_idea = water_shortages_3
		}
	}
	else_if = {
		limit = { has_idea = water_shortages_5 }
		swap_ideas = {
			remove_idea = water_shortages_5
			add_idea = water_shortages_4
		}
	}
}

CHI_open_nation_level_up = {
	if = {
		limit = { has_idea = censored_nation_01 }
		swap_ideas = {
			remove_idea = censored_nation_01
			add_idea = open_nation_01
		}
	}
	else_if = {
		limit = { has_idea = open_nation_01 }
		swap_ideas = {
			remove_idea = open_nation_01
			add_idea = open_nation_02
		}
	}
	else_if = {
		limit = { has_idea = open_nation_02 }
		swap_ideas = {
			remove_idea = open_nation_02
			add_idea = open_nation_03
		}
	}
	else_if = {
		limit = { has_idea = open_nation_03 }
		swap_ideas = {
			remove_idea = open_nation_03
			add_idea = open_nation_04
		}
	}
	else_if = {
		limit = { has_idea = open_nation_04 }
		swap_ideas = {
			remove_idea = open_nation_04
			add_idea = open_nation_05
		}
	}
	else_if = {
		limit = { has_idea = open_nation_05 }
		swap_ideas = {
			remove_idea = open_nation_05
			add_idea = open_nation_06
		}
	}
	else_if = {
		limit = { has_idea = open_nation_06 }
		swap_ideas = {
			remove_idea = open_nation_06
			add_idea = open_nation_07
		}
	}
}

CHI_censored_nation_level_up = {
	if = {
		limit = { has_idea = censored_nation_01 }
		swap_ideas = {
			remove_idea = censored_nation_01
			add_idea = censored_nation_02
		}
	}
	else_if = {
		limit = { has_idea = censored_nation_02 }
		swap_ideas = {
			remove_idea = censored_nation_02
			add_idea = censored_nation_03
		}
	}
	else_if = {
		limit = { has_idea = censored_nation_03 }
		swap_ideas = {
			remove_idea = censored_nation_03
			add_idea = censored_nation_04
		}
	}
	else_if = {
		limit = { has_idea = censored_nation_04 }
		swap_ideas = {
			remove_idea = censored_nation_04
			add_idea = censored_nation_05
		}
	}
	else_if = {
		limit = { has_idea = censored_nation_05 }
		swap_ideas = {
			remove_idea = censored_nation_05
			add_idea = censored_nation_06
		}
	}
	else_if = {
		limit = { has_idea = censored_nation_06 }
		swap_ideas = {
			remove_idea = censored_nation_06
			add_idea = censored_nation_07
		}
	}
	else_if = {
		limit = { has_idea = closed_nation }
		swap_ideas = {
			remove_idea = closed_nation
			add_idea = censored_nation_01
		}
	}
}

CHI_five_state_infrastructure_via_focus = {
	random_owned_controlled_state = {
		limit = {
			free_building_slots = {
				building = infrastructure
				size > 0
			}
			OR = {
				is_in_home_area = yes
				NOT = {
					owner = {
						any_owned_state = {
							free_building_slots = {
								building = infrastructure
								size > 0
							}
							is_in_home_area = yes
						}
					}
				}
			}
		}
		add_building_construction = {
			type = infrastructure
			level = 2
			instant_build = yes
		}
	}
	random_owned_controlled_state = {
		limit = {
			free_building_slots = {
				building = infrastructure
				size > 0
			}
			OR = {
				is_in_home_area = yes
				NOT = {
					owner = {
						any_owned_state = {
							free_building_slots = {
								building = infrastructure
								size > 0
							}
							is_in_home_area = yes
						}
					}
				}
			}
		}
		add_building_construction = {
			type = infrastructure
			level = 2
			instant_build = yes
		}
	}
	random_owned_controlled_state = {
		limit = {
			free_building_slots = {
				building = infrastructure
				size > 0
			}
			OR = {
				is_in_home_area = yes
				NOT = {
					owner = {
						any_owned_state = {
							free_building_slots = {
								building = infrastructure
								size > 0
							}
							is_in_home_area = yes
						}
					}
				}
			}
		}
		add_building_construction = {
			type = infrastructure
			level = 2
			instant_build = yes
		}
	}
	random_owned_controlled_state = {
		limit = {
			free_building_slots = {
				building = infrastructure
				size > 0
			}
			OR = {
				is_in_home_area = yes
				NOT = {
					owner = {
						any_owned_state = {
							free_building_slots = {
								building = infrastructure
								size > 0
							}
							is_in_home_area = yes
						}
					}
				}
			}
		}
		add_building_construction = {
			type = infrastructure
			level = 2
			instant_build = yes
		}
	}
	random_owned_controlled_state = {
		limit = {
			free_building_slots = {
				building = infrastructure
				size > 0
			}
			OR = {
				is_in_home_area = yes
				NOT = {
					owner = {
						any_owned_state = {
							free_building_slots = {
								building = infrastructure
								size > 0
							}
							is_in_home_area = yes
						}
					}
				}
			}
		}
		add_building_construction = {
			type = infrastructure
			level = 2
			instant_build = yes
		}
	}
}

CHI_advance_moon_base = {
	hidden_effect = {
		random_list = {
			40 = {
				modifier = {
					factor = 0
					has_country_flag = chi_moon_base_first_progression
				}
				set_country_flag = chi_moon_base_first_progression
				country_event = { id = chi_moon.3 days = 30 random_hours = 480 } #First progression
			}
			40 = {
				modifier = {
					factor = 0
					OR = {
						has_country_flag = chi_moon_base_second_progression
						NOT = {
							has_country_flag = chi_moon_base_first_progression
						}
					}
				}
				set_country_flag = chi_moon_base_second_progression
				country_event = { id = chi_moon.5 days = 30 random_hours = 480 } #Second progression
			}
			40 = {
				modifier = {
					factor = 0
					has_country_flag = chi_moon_base_first_crisis
				}
				set_country_flag = chi_moon_base_first_crisis
				country_event = { id = chi_moon.4 days = 30 random_hours = 480 } #First crisis
			}
			40 = {
				modifier = {
					factor = 0
					OR = {
						has_country_flag = chi_moon_base_second_crisis
						NOT = {
							has_country_flag = chi_moon_base_first_crisis
						}
					}
				}
				set_country_flag = chi_moon_base_second_crisis
				country_event = { id = chi_moon.6 days = 30 random_hours = 480 } #Second crisis
			}
			20 = {
				modifier = {
					factor = 0
					NOT = {
						has_country_flag = chi_moon_base_second_progression
					}
				}
				set_country_flag = chi_moonbase_beta_completed
				country_event = { id = chi_moon.7 days = 15 random_hours = 240 } #Moonbase Beta
			}
		}
	}
}

SCO_dirty_update = {
	if = { limit = { check_variable = { SCO_dirty_update_var < 10000 } }
		add_to_variable = { SCO_dirty_update_var = 1 }
	}
	else = {
		set_variable = { SCO_dirty_update_var = 1 }
	}
}
