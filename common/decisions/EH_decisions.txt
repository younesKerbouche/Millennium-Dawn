EH_electric_traps_category = {
	EH_set_up_electric_trap = {
		icon = GFX_decision_fixes_button
		days_remove = 7

		state_target = yes

		on_map_mode = map_only
        highlight_states = {
	    	highlight_states_trigger = {
                is_controlled_by = ROOT
	    		has_state_flag = EH_electric_trap_enabled_flag
	    	}
	    	highlight_color_before_active = 3
	    	highlight_color_while_active = 2
	    }
		target_trigger = {
            FROM = {
                is_controlled_by = ROOT
                has_state_flag = EH_electric_trap_enabled_flag
            }
        }

		available = {
			has_resources_in_country = {
                resource = tungsten
                amount > 0
            }
		}

		visible = {
			FROM = {
				NOT = { has_state_flag = EH_electric_trap_set_up_flag }
			}
		}

		remove_effect = {
			FROM = {
				set_state_flag = EH_electric_trap_set_up_flag
			}
			add_to_variable = { EH_electric_trap_country_resource_cost_tungsten_var = 1 }
			custom_effect_tooltip = EH_electric_trap_country_resource_cost_tungsten_TT
		}
	}
    EH_remove_electric_trap = {
		icon = GFX_decision_fixes_button_blocked
		days_remove = 7

		state_target = yes

		on_map_mode = map_only

		highlight_states = {
	    	highlight_states_trigger = {
                is_controlled_by = ROOT
	    		has_state_flag = EH_electric_trap_enabled_flag
	    	}
	    	highlight_color_before_active = 3
	    	highlight_color_while_active = 2
	    }

		target_trigger = {
            FROM = {
                is_controlled_by = ROOT
                has_state_flag = EH_electric_trap_set_up_flag
            }
        }

		visible = {
			FROM = {
				has_state_flag = EH_electric_trap_set_up_flag
			}
		}

        available = {
            FROM = {
                NOT = {
                    has_state_flag = EH_electric_trap_active_flag
                }
            }
        }

        complete_effect = {
            FROM = {
                set_state_flag = EH_electric_trap_removing_flag
            }
        }

		remove_effect = {
			FROM = {
				clr_state_flag = EH_electric_trap_set_up_flag
                clr_state_flag = EH_electric_trap_removing_flag
			}
			add_to_variable = { EH_electric_trap_country_resource_cost_tungsten_var = -1 }
			custom_effect_tooltip = EH_electric_trap_remove_country_resource_cost_tungsten_TT
		}
	}
    EH_activate_electric_trap = {
        icon = GFX_decision_influence
        days_remove = 10

        state_target = yes

        on_map_mode = map_only

        highlight_states = {
	    	highlight_states_trigger = {
                is_controlled_by = ROOT
	    		has_state_flag = EH_electric_trap_enabled_flag
	    	}
	    	highlight_color_before_active = 3
	    	highlight_color_while_active = 2
	    }

        target_trigger = {
            FROM = {
                is_controlled_by = ROOT
                has_state_flag = EH_electric_trap_set_up_flag
            }
        }

		visible = {
			FROM = {
				has_state_flag = EH_electric_trap_set_up_flag
			}
		}

        available = {
            FROM = {
                NOT = {
                    has_state_flag = EH_electric_trap_cooldown
                    has_state_flag = EH_electric_trap_removing_flag
                }
            }
        }

        complete_effect = {
            if = {
                limit = {
                    NOT = {
                        has_dynamic_modifier = {
                            modifier = EH_electric_trap_country_effects_idea
                        }
                    }
                }
                hidden_effect = {
                    add_dynamic_modifier = {
                        modifier = EH_electric_trap_country_effects_idea
                    }
                }
            }
            add_to_variable = { EH_electric_trap_energy_use_var = 0.1 }
            custom_effect_tooltip = EH_electric_trap_energy_use_TT
            FROM = {
                set_state_flag = EH_electric_trap_active_flag
				add_state_modifier = {
    				modifier = {
        				enemy_attrition = 0.2
						enemy_army_speed_factor = -0.15
    				}
				}
            }
        }

        remove_effect = {
            # Effects for country
            add_to_variable = { EH_electric_trap_energy_use_var = -0.1 }
            FROM = {
                # Effects for state
                set_state_flag = {
                    flag = EH_electric_trap_cooldown
                    days = 15
                    value = 1
                }
                clr_state_flag = EH_electric_trap_active_flag
				add_state_modifier = {
    				modifier = {
        				enemy_attrition = -0.2
						enemy_army_speed_factor = 0.15
    				}
				}
            }
        }
    }
}

EH_research_sites_category = {
    EH_setup_research_site = {
        icon = GFX_decision_generic_research
        days_remove = var:EH_research_sites_prep_time_var

        available = {
            EH_any_controlled_state_1500_to_any_portal = yes
            custom_trigger_tooltip = {
                tooltip = EH_research_sites_limit_TT
                check_variable = { EH_research_sites_constructed_var < 10 }
            }
        }

        complete_effect = {
            set_temp_variable = { treasury_change = -15 }
            if = {
                limit = {
                    has_country_flag = EH_research_sites_anti_air_installed_flag
                }
                subtract_from_temp_variable = { treasury_change = 5 }
            }
            modify_treasury_effect = yes
            custom_effect_tooltip = EH_research_sites_cost_TT
        }

        remove_effect = {
            add_to_variable = { EH_research_sites_constructed_var = 1}
            EH_calculate_research_sites_effects = yes
            if = {
                limit = {
                    NOT = {
                        has_dynamic_modifier = {
                            modifier = EH_research_sites_effects_idea
                        }
                    }
                }
                add_dynamic_modifier = {
                    modifier = EH_research_sites_effects_idea
                }
            }
            custom_effect_tooltip = EH_add_research_site_TT
        }
    }

    EH_install_anti_air_weapons = {
        icon = GFX_decision_shoot_bird
        days_remove = 60
        fire_only_once = yes

        available = {
            EH_has_research_site = yes
        }

        complete_effect = {
            set_temp_variable = { treasury_change = -5 }
            multiply_temp_variable = { treasury_change = EH_research_sites_constructed_var }
			modify_treasury_effect = yes
            custom_effect_tooltip = EH_research_sites_cost_scaling_TT
            set_country_flag = EH_research_sites_anti_air_installed_flag
        }

        remove_effect = {
            set_temp_variable = { EH_temp_protection_increase = 25 }
            EH_research_sites_protection_increase = yes
        }
    }

    EH_panic_shelters_and_land_turrets = {
        icon = GFX_decision_conter_raid_button
        days_remove = 60
        fire_only_once = yes

        available = {
            EH_has_research_site = yes
        }

        complete_effect = {
            set_temp_variable = { treasury_change = -5 }
            multiply_temp_variable = { treasury_change = EH_research_sites_constructed_var }
			modify_treasury_effect = yes
            custom_effect_tooltip = EH_research_sites_cost_scaling_TT
            set_country_flag = EH_research_sites_shelters_installed_flag
        }

        remove_effect = {
            set_temp_variable = { EH_temp_protection_increase = 15 }
            EH_research_sites_protection_increase = yes
            set_temp_variable = { EH_temp_research_sites_scientist_protection_increase = 10 }
            EH_research_sites_scientist_protection_increase = yes
        }
    }

    EH_hire_additional_security_for_scientists = {
        icon = GFX_decision_recruit_operative
        days_remove = 40
        fire_only_once = yes

        available = {
            EH_has_research_site = yes
        }

        complete_effect = {
            set_temp_variable = { treasury_change = -3 }
            multiply_temp_variable = { treasury_change = EH_research_sites_constructed_var }
			modify_treasury_effect = yes
            custom_effect_tooltip = EH_research_sites_cost_scaling2_TT
            set_country_flag = EH_research_sites_security_hired_flag
        }

        remove_effect = {
            set_temp_variable = { EH_temp_research_sites_scientist_protection_increase = 25 }
            EH_research_sites_scientist_protection_increase = yes
        }
    }

    EH_disable_site_notifications = {
        icon = GFX_decision_message_decline_button

        visible = {
            NOT = { has_country_flag = EH_research_sites_disable_notifications_flag }
        }

        remove_effect = {
            set_country_flag = EH_research_sites_disable_notifications_flag
            custom_effect_tooltip = EH_research_sites_disable_notifications_TT
        }
    }

    EH_enable_site_notifications = {
        icon = GFX_decision_message_accept_button

        visible = {
            has_country_flag = EH_research_sites_disable_notifications_flag
        }

        remove_effect = {
            clr_country_flag = EH_research_sites_disable_notifications_flag
            custom_effect_tooltip = EH_research_sites_enable_notifications_TT
        }
    }

    EH_doudna_or_charpentier_project_mission = {
        activation = {
            OR = {
                has_country_flag = EH_hired_jennifer_doudna_flag
                has_country_flag = EH_hired_emmanuelle_charpentier_flag
            }
        }

        available = {
            has_war_with = ALN
            has_country_flag = EH_research_sites_enabled
            NOT = {
                has_country_flag = EH_doudna_or_charpentier_finished_project_flag
            }
        }

        cancel_trigger = {
            NOT = {
                has_country_flag = EH_hired_jennifer_doudna_flag
                has_country_flag = EH_hired_emmanuelle_charpentier_flag
            }
        }

        icon = GFX_decision_jennifer_emmanuelle
        is_good = yes
        days_mission_timeout = 280

        timeout_effect = {
            set_country_flag = EH_doudna_or_charpentier_finished_project_flag
            custom_effect_tooltip = EH_doudna_or_charpentier_finished_project_TT
        }
    }
}

EH_find_new_veins_category = {
    EH_search_for_randallite_veins = {
        icon = GFX_decision_search_for_randallite
        days_remove = var:EH_search_for_randallite_veins_time_var
        days_re_enable = 10

        fixed_random_seed = no

        available = {
            set_temp_variable = { EH_controlled_states = num_of_controlled_states }
            divide_temp_variable = { EH_controlled_states = 7 }
            round_temp_variable = EH_controlled_states
            custom_trigger_tooltip = {
                tooltip = EH_randallite_veins_limit_TT
                check_variable = { EH_mines_set_up_var < EH_controlled_states }
            }

            OR = {
                NOT = {
                    has_active_mission = EH_set_up_mine_mission
                }
                has_completed_focus = EH_new_enemy_new_strategy
            }
        }

        modifier = {
            cic_construction_boost_factor = -0.06
            resource_sector_workers_modifier = 0.08
        }

        complete_effect = {
            if = {
                limit = {
                    NOT = {
                        has_active_mission = EH_set_up_mine_mission
                    }
                }
                set_temp_variable = { treasury_change = -10 }
                modify_treasury_effect = yes
            }
            else = {
                set_temp_variable = { treasury_change = -25 }
                modify_treasury_effect = yes
                add_timed_idea = { idea = EH_economy_overload_idea days = var:EH_search_for_randallite_veins_time_var }
            }
        }

        remove_effect = {
            random_list = {
                60 = {
                    country_event = EH_focus_event.12
                }
                20 = {
                    country_event = EH_focus_event.13
                }
                20 = {
                    country_event = EH_focus_event.14
                }
            }
        }
    }

    EH_set_up_mine_mission = {
        icon = GFX_decision_search_for_randallite
        is_good = yes
        days_mission_timeout = var:EH_set_up_mine_time_var

        activation = {
            always = no
        }

        available = {
            always = no
        }

        timeout_effect = {
            if = {
                limit = {
                    has_country_flag = EH_setting_up_randallite_mine_flag
                }
                set_temp_variable = { add_randallite = EH_add_randallite_random }
                EH_add_randallite_effect = yes
                clr_country_flag = EH_setting_up_randallite_mine_flag
            }
            if = {
                limit = {
                    has_country_flag = EH_setting_up_iron_mine_flag
                }
                random_controlled_state = {
                    add_resource = {
                        type = steel
                        amount = 2
                    }
                }
                clr_country_flag = EH_setting_up_iron_mine_flag
            }
            if = {
                limit = {
                    has_country_flag = EH_setting_up_aluminium_mine_flag
                }
                random_controlled_state = {
                    add_resource = {
                        type = aluminium
                        amount = 2
                    }
                }
                clr_country_flag = EH_setting_up_aluminium_mine_flag
            }
            add_to_variable = { EH_mines_set_up_var = 1 }
        }
    }

    EH_large_company_seeks_for_randallite_mission = {
        icon = GFX_decision_gre_investment_decisions
        days_mission_timeout = 100

        activation = {
            NOT = {
                has_country_flag = EH_outlawed_randallite_extraction_flag
            }
        }

        available = {
            NOT = {
                has_country_flag = EH_outlawed_randallite_extraction_flag
            }
        }

        timeout_effect = {
            random = {
                chance = 80
                country_event = EH_focus_event.15
                set_variable = { EH_non_state_mines_corporate_tax_income_var = 0.05 }
                add_to_variable = { EH_non_state_mines_var = 1 }
                multiply_variable = { EH_non_state_mines_corporate_tax_income_var = EH_non_state_mines_var }

                if = {
                    limit = {
                        NOT = {
                            has_dynamic_modifier = {
                                modifier = EH_non_state_mines_modifier
                                scope = ROOT
                            }
                        }
                    }
                    add_dynamic_modifier = {
                        modifier = EH_non_state_mines_modifier
                        scope = ROOT
                    }
                    newline = yes
                    custom_effect_tooltip = EH_non_state_mines_modifier_TT
                }
                set_variable = { EH_non_state_mines_var = 0 }
                newline = yes
                custom_effect_tooltip = EH_non_state_mines_TT
            }
        }
    }

    EH_outlaw_randallite_extraction = {
        icon = GFX_decision_randallite_outlawed
        days_remove = 30

        visible = {
            NOT = {
                has_country_flag = EH_outlawed_randallite_extraction_flag
            }
            check_variable = { EH_non_state_mines_var > 0 }
        }

        modifier = {
            political_power_gain = -1
        }

        remove_effect = {
            set_temp_variable = { EH_outlaw_randallite_stability_penalty = -0.04 }
            set_temp_variable = { EH_outlaw_randallite_pp_penalty = -50 }
            set_temp_variable = { EH_outlaw_randallite_randallite_gain = 2 }

            multiply_temp_variable = { EH_outlaw_randallite_stability_penalty = EH_non_state_mines_var }
            multiply_temp_variable = { EH_outlaw_randallite_pp_penalty = EH_non_state_mines_var }
            multiply_temp_variable = { EH_outlaw_randallite_randallite_gain = EH_non_state_mines_var }

            add_stability = EH_outlaw_randallite_stability_penalty
            add_political_power = EH_outlaw_randallite_pp_penalty
            set_temp_variable = { add_randallite = EH_outlaw_randallite_randallite_gain }
            EH_add_randallite_effect = yes

            set_variable = { EH_non_state_mines_var = 0 }

            newline = yes

            set_country_flag = EH_outlawed_randallite_extraction_flag
            custom_effect_tooltip = EH_outlaw_randallite_extraction_TT

            newline = yes

            increase_corruption = yes
        }
    }

    EH_legalize_randallite_extraction = {
        icon = GFX_decision_randallite_allowed
        days_remove = 30

        visible = {
            has_country_flag = EH_outlawed_randallite_extraction_flag
        }

        modifier = {
            political_power_gain = -0.5
        }

        remove_effect = {
            clr_country_flag = EH_outlawed_randallite_extraction_flag
            custom_effect_tooltip = EH_legalize_randallite_extraction_TT
        }
    }
}