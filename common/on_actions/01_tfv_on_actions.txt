on_actions = {
	on_capitulation = { }

	#ROOT is subject FROM is previous overlord
	on_subject_free = {
		effect = {
			ROOT = {
				calculate_influence_percentage = yes #set alignment drifts from influence
				startup_politics = yes
				ingame_update_setup = yes 	#money system
				setup_init_factions = yes 	#flags for int. factions
				set_law_vars = yes 	#vars for change laws secondary effects
				update_neighbors_effects = yes # Updates Neighbor Effects
				economic_cycle_drift_popularity = yes # Actually impacts the economic cycle drifts
				if = { limit = { is_ai = yes }
					ai_update_build_units = yes
				}

				country_event = { id = brotherhood.0 } #Sets muslim_brotherhood relations
				if = {
					limit = {
						NOT = { has_variable = domestic_influence_amount }
					}
					set_variable = { domestic_influence_amount = 100 }
				}
				recalculate_influence = yes

				# Union state flag
				if = {
					limit = { has_country_flag = BLR_unionstate_agree }
					clr_country_flag = BLR_unionstate_agree
				}
			}
		}
	}

	#ROOT is subject FROM is overlord
	on_subject_annexed = {
		effect = { ##Grants Cores on Annexation
			ROOT = {
				for_each_scope_loop = {
					array = core_states
					add_core_of = FROM
				}
				if = { limit = { original_tag = LBA }
					set_country_flag = LBA_prevent_giving_tribal_traits
				}
				every_unit_leader = {
					set_nationality = FROM
				}
				if = { limit = { original_tag = LBA }
					clr_country_flag = LBA_prevent_giving_tribal_traits
				}
				if = {
					limit = { has_country_flag = overlord_subsidies }
					clr_country_flag = overlord_subsidies
					clr_country_flag = overlord_is_subsidizing_us_@FROM
				}
				if = {
					limit = {
						has_country_flag = SCO_joint_exercises_offered
					}
					clr_country_flag = SCO_joint_exercises_offered
				}
				FROM = {
					if = {
						limit = { ROOT = { has_country_flag = overlord_subsidies } }
						clr_country_flag = overlord_subsidies
						clr_country_flag = overlord_is_subsidizing_us_@ROOT
					}
					if = {
						limit = {
							has_country_flag = SCO_joint_exercises_offered
						}
						clr_country_flag = SCO_joint_exercises_offered
					}
					add_to_variable = { treasury = ROOT.treasury }
					add_to_variable = { debt = ROOT.debt }
					add_to_variable = { int_investments = ROOT.int_investments }

					country_event = { id = overlord.1 }
					if = { limit = { original_tag = USA }
						add_to_array = { USA_collapse_releases = ROOT.id }
					}
				}
			}
		}
	}

	#used when puppeting in a peace conference
	#ROOT = nation being puppeted, FROM = overlord
	on_puppet = {
		effect = {
			ROOT = {
				effect_puppet_match_ruling_party_to_overlord = yes #Just to ensure a correct thing
				research_slot_init_for_country = yes
				calculate_expected_spending = yes
				effect_puppet_match_ruling_party_to_overlord = yes
				set_temp_variable = { percent_change = 30 }
				set_temp_variable = { tag_index = FROM.id }
				set_temp_variable = { influence_target = THIS.id }
				change_influence_percentage = yes
			}
			if = {
				limit = { FROM = { has_idea = faction_resistance_axis_member } }
				ROOT = { add_ideas = faction_resistance_axis_member }
			}
		}
	}

	#ROOT = nation being liberated, FROM = leader of the liberators
	on_liberate = {
		effect = {
			log = "[GetDateText]: [This.GetName]: country [ROOT.GetName]|[THIS.GetName] is liberated by [FROM.GetName]"
			# if basic setup failed for some reason - country file not loaded
			if = { limit = { NOT = { country_exists = ROOT } }
				if = {
					limit = {
						NOT = {
							has_idea = sunni
							has_idea = shia
							has_idea = sufi_islam
							has_idea = ibadi
							has_idea = christian
							has_idea = orthodox_christian
							has_idea = pluralist
							has_idea = buddism
							has_idea = hindu
							has_idea = judaism
							has_idea = shinto
							has_idea = cheondo
							has_idea = uniate_church
							has_idea = zoroastrian
						}
					}

					log = "[GetDateText]: [This.GetName]: country [ROOT.GetName] history file is not loaded"

					set_variable = { parent_tag = FROM }
					# Russian shards
					if = {
						limit = {
							OR = {
								tag = CSB
								tag = ESB
								tag = DON
								tag = KAE
							}
						}

						set_variable = { parent_tag = SOV }
					}

					log = "[GetDateText]: [This.GetName]: country [ROOT.GetName] parent tag is setup as [?parent_tag.GetName]"

					ROOT = {
						if = {
							limit = {
								NOT = { has_variable = domestic_influence_amount }
							}
							set_variable = { domestic_influence_amount = 100 }
						}
						if = {
							limit = { NOT = { has_variable = corporate_tax_rate } }
							set_variable = { var = corporate_tax_rate value = 20 }
						}
						if = {
							limit = { NOT = { has_variable = population_tax_rate } }
							set_variable = { var = population_tax_rate value = 20 }
						}
						ingame_init_investment_system = yes
						init_auto_influence_array = yes

						calculate_influence_percentage = yes #set alignment drifts from influence
						startup_politics = yes
						ingame_update_setup = yes 	#money system
						setup_init_factions = yes 	#flags for int. factions
						set_law_vars = yes 	#vars for change laws secondary effects
						update_neighbors_effects = yes # Updates Neighbor Effects
						economic_cycle_drift_popularity = yes #drift from neighbor
						ai_update_build_units = yes
						calculate_expected_spending = yes

						set_temp_variable = { nation_to_copy_from = FROM.id }
						replicate_configure_politics = yes

						#VARIABLES
						set_variable = { var = corporate_tax_rate value = FROM.corporate_tax_rate }
						set_variable = { var = population_tax_rate value = FROM.population_tax_rate }
						set_variable = { treasury = 0 }

						set_variable = { civilian_factory_employment_var = FROM.civilian_factory_employment_var }
						set_variable = { naval_factory_employment_var = FROM.naval_factory_employment_var }
						set_variable = { military_factory_employment_var = FROM.military_factory_employment_var }
						set_variable = { office_employment_var = FROM.office_employment_var }
						set_variable = { agriculture_district_employment_var = FROM.agriculture_district_employment_var }

						#don't get values of original yet - REMINDER -> add it on_civil_war_end
						set_variable = { debt = 0 }
						set_variable = { int_investments = 0 }

						#influence
						set_variable = { domestic_influence_amount = FROM.domestic_influence_amount }
						#just copy all
						for_loop_effect = {
							end = FROM.influence_array^num
							value = v

							add_to_array = { influence_array = FROM.influence_array^v }
							add_to_array = { influence_array_val = FROM.influence_array_val^v }
						}
						recalculate_influence = yes

						#GAME VARIABLES
						add_political_power = FROM.political_power
						add_political_power = 400 #bonus

						#LAWS
						set_variable = { gdp_per_capita = FROM.gdp_per_capita }
						update_laws_for_new_nation = yes

						### Internal factions
						set_temp_variable = { nation_to_copy_from = FROM.id }
						copy_internal_factions = yes
						#copy leader throughput
						set_temp_variable = { nation_to_copy_from = FROM.id }
						copy_subideolgy_leader_throughput = yes

						calculate_influence_percentage = yes #set alignment drifts from influence
						ingame_update_setup = yes 	#money system
						setup_init_factions = yes 	#flags for int. factions
						update_neighbors_effects = yes # Updates Neighbor Effects
						economic_cycle_drift_popularity = yes #drift from neighbor

						set_temp_variable = { nation_to_copy_from = PREV.id }
						configure_religious_setup = yes

						country_event = { id = brotherhood.0 } #Sets muslim_brotherhood relations

						inherit_technology = FROM

						add_ideas = { police_02 }
						add_ideas = { health_02 }
						add_ideas = { bureau_02 }
						add_ideas = { edu_02 }
						add_ideas = { social_02 }
						add_ideas = { defence_02 }
					}
				}
				else = {
					ROOT = {
						set_temp_variable = { percent_change = 15 }
						set_temp_variable = { tag_index = FROM.id }
						set_temp_variable = { influence_target = ROOT.id }

						if = {
							limit = { NOT = { has_variable = corporate_tax_rate } }
							set_variable = { var = corporate_tax_rate value = 20 }
						}
						if = {
							limit = { NOT = { has_variable = population_tax_rate } }
							set_variable = { var = population_tax_rate value = 20 }
						}
						ingame_init_investment_system = yes
						init_auto_influence_array = yes

						calculate_influence_percentage = yes #set alignment drifts from influence
						startup_politics = yes
						setup_init_factions = yes 	#flags for int. factions
						set_law_vars = yes 	#vars for change laws secondary effects
						update_neighbors_effects = yes # Updates Neighbor Effects
						economic_cycle_drift_popularity = yes #drift from neighbor
						ai_update_build_units = yes
						calculate_expected_spending = yes

						set_variable = { civilian_factory_employment_var = FROM.civilian_factory_employment_var }
						set_variable = { naval_factory_employment_var = FROM.naval_factory_employment_var }
						set_variable = { military_factory_employment_var = FROM.military_factory_employment_var }
						set_variable = { office_employment_var = FROM.office_employment_var }
						set_variable = { agriculture_district_employment_var = FROM.agriculture_district_employment_var }

						ingame_update_setup = yes 	#money system
						research_slot_init_for_country = yes
					}
				}
			}
		}
	}

	#used when puppeting through the occupied territories menu during peace time (or when releasing from non-core but owned territory, f.e. Britain releasing Egypt)
	#ROOT = nation being released, FROM = overlord
	on_release_as_puppet = {
		effect = {
			ROOT = {
				set_variable = { civilian_factory_employment_var = 1 }
				set_variable = { naval_factory_employment_var = 1 }
				set_variable = { military_factory_employment_var = 1 }
				set_variable = { office_employment_var = 1 }
				set_variable = { agriculture_district_employment_var = 1 }
				set_variable = { gdpc_converging_var = FROM.gdpc_converging_var }
				country_event = { id = brotherhood.0 } #Sets muslim_brotherhood relations
				if = {
					limit = {
						NOT = { has_variable = domestic_influence_amount }
					}
					set_variable = { domestic_influence_amount = 100 }
				}
				if = {
					limit = { FROM = { has_government = democratic } }
					set_politics = {
						ruling_party = democratic
						last_election = "1999.10.3"
						election_frequency = 60
						elections_allowed = yes
					}
					set_popularities = {
						democratic = 70.0 #Western
						communism = 10.0 #Emerging
						fascism = 0.0 #Salafist
						neutrality = 10.0 #Non Aligned
						nationalist = 10.0 #Nationalist
					}
				}
				if = {
					limit = { FROM = { has_government = communism } }
					set_politics = {
						ruling_party = communism
						last_election = "1999.10.3"
						election_frequency = 60
						elections_allowed = yes
					}
					set_popularities = {
						democratic = 10.0 #Western
						communism = 70.0 #Emerging
						fascism = 0.0 #Salafist
						neutrality = 10.0 #Non Aligned
						nationalist = 10.0 #Nationalist
					}
				}
				if = {
					limit = { FROM = { has_government = neutrality } }
					set_politics = {
						ruling_party = neutrality
						last_election = "1999.10.3"
						election_frequency = 60
						elections_allowed = yes
					}
					set_popularities = {
						democratic = 10.0 #Western
						communism = 10.0 #Emerging
						fascism = 0.0 #Salafist
						neutrality = 70.0 #Non Aligned
						nationalist = 10.0 #Nationalist
					}
				}
				if = {
					limit = { FROM = { has_government = nationalist } }
					set_politics = {
						ruling_party = nationalist
						last_election = "1999.10.3"
						election_frequency = 60
						elections_allowed = yes
					}
					set_popularities = {
						democratic = 10.0 #Western
						communism = 10.0 #Emerging
						fascism = 0.0 #Salafist
						neutrality = 10.0 #Non Aligned
						nationalist = 70.0 #Nationalist
					}
				}
				if = {
					limit = { FROM = { has_government = fascism } }
					set_politics = {
						ruling_party = fascism
						last_election = "1999.10.3"
						election_frequency = 60
						elections_allowed = no
					}
					set_popularities = {
						democratic = 10.0 #Western
						communism = 10.0 #Emerging
						fascism = 70.0 #Salafist
						neutrality = 10.0 #Non Aligned
						nationalist = 0.0 #Nationalist
					}
				}
				if = {
					limit = { FROM = { NOT = { has_government = fascism } } }
					set_temp_variable = { year_change = 3 }
					set_election_year_60_months = yes
				}
				ingame_init_investment_system = yes
				init_auto_influence_array = yes
				inherit_technology = FROM
				if = {
					limit = {
						OR = {
							NOT = { has_variable = corporate_tax_rate }
							NOT = { has_variable = population_tax_rate }
						}
					}
					set_variable = { var = corporate_tax_rate value = 20 }
					set_variable = { var = population_tax_rate value = 20 }
				}

				calculate_influence_percentage = yes #set alignment drifts from influence
				startup_politics = yes
				ingame_update_setup = yes 	#money system
				setup_init_factions = yes 	#flags for int. factions
				set_law_vars = yes 	#vars for change laws secondary effects
				update_neighbors_effects = yes # Updates Neighbor Effects
				economic_cycle_drift_popularity = yes #drift from neighbor
				ai_update_build_units = yes
				effect_puppet_match_ruling_party_to_overlord = yes #Just to ensure a correct thing
				research_slot_init_for_country = yes
				calculate_expected_spending = yes

				setup_missile_configuration_effect = yes
			}
		}
	}

	#ROOT is free nation FROM is releaser
	on_release_as_free = {
		effect = {
			ROOT = {
				set_variable = { civilian_factory_employment_var = 1 }
				set_variable = { naval_factory_employment_var = 1 }
				set_variable = { military_factory_employment_var = 1 }
				set_variable = { office_employment_var = 1 }
				set_variable = { agriculture_district_employment_var = 1 }
				set_variable = { gdpc_converging_var = FROM.gdpc_converging_var }
				country_event = { id = brotherhood.0 } #Sets muslim_brotherhood relations
				if = {
					limit = {
						NOT = { has_variable = domestic_influence_amount }
					}
					set_variable = { domestic_influence_amount = 100 }
				}
				if = {
					limit = { NOT = { has_variable = corporate_tax_rate } }
					set_variable = { var = corporate_tax_rate value = 20 }
				}
				if = {
					limit = { NOT = { has_variable = population_tax_rate } }
					set_variable = { var = population_tax_rate value = 20 }
				}
				ingame_init_investment_system = yes
				init_auto_influence_array = yes

				calculate_influence_percentage = yes #set alignment drifts from influence
				startup_politics = yes
				ingame_update_setup = yes 	#money system
				setup_init_factions = yes 	#flags for int. factions
				set_law_vars = yes 	#vars for change laws secondary effects
				update_neighbors_effects = yes # Updates Neighbor Effects
				economic_cycle_drift_popularity = yes #drift from neighbor
				ai_update_build_units = yes
				calculate_expected_spending = yes

				setup_missile_configuration_effect = yes
			}
			set_temp_variable = { percent_change = 5 }
			set_temp_variable = { tag_index = FROM.id }
			set_temp_variable = { influence_target = ROOT.id }
			change_influence_percentage = yes
			research_slot_init_for_country = yes
		}
	}
}
