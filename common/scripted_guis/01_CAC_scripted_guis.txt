scripted_gui = {
	companies_slot = {
		window_name = "companies_slot"
        context_type = player_context
		parent_window_token = politics_tab

		effects = {
            companies_slot_btn_click = {
				if = {
					limit = {
						has_country_flag = CAC_companies_list
					}

					clr_country_flag = CAC_companies_list
					set_variable = { opened_company_details = -1 }
				}
				else = {
					if = {
						limit = { NOT = { check_variable = { CAC_companies^num = CAC_sorted_companies^num } } }

						clear_array = CAC_sorted_companies

						for_each_loop = {
							array = CAC_companies
							value = v
							add_to_array = { CAC_sorted_companies = v }
						}
					}

					set_country_flag = CAC_companies_list
				}
            }
		}
	}

    companies_list_window = {
		window_name = "companies_list_window"
        context_type = player_context
		parent_window_token = politics_tab

        visible = {
			ROOT = {
				AND = {
					is_ai = no
					has_country_flag = CAC_companies_list
				}
			}
		}
		
		effects = {
			companies_details_button_click = {
				for_each_loop = {
					array = CAC_companies
					value = company_id
					index = index
					break = break

					if = {
						limit = {
							check_variable = { v = company_id }
						}

						set_variable = { opened_company_details = index }
						set_temp_variable = { break = 1 }
					}
				}

				clr_country_flag = ceo_window_open
			}

			sort_size_click = {
				clear_array = CAC_sorted_companies

				for_loop_effect = {
					start = 0
					end = CAC_companies^num
					value = i

					set_temp_variable = { added = 0 }

					for_each_loop = {
						array = CAC_sorted_companies
						index = j
						value = v
						break = added

						set_temp_variable = { index = CAC_sorted_companies^j }

						if = {
							limit = {
								AND = {
									check_variable = { CAC_companies_size^v < CAC_companies_size^i }
								}
							}

							add_to_array = {
								array = CAC_sorted_companies
								value = CAC_companies^i
								index = j
							}

							set_temp_variable = { added = 1 }
						}
					}

					if = {
						limit = { check_variable = { added = 0 } }

						add_to_array = {
							array = CAC_sorted_companies
							value = CAC_companies^i
							index = CAC_sorted_companies^num
						}
					}
				}
			}

			sort_money_click = {
				clear_array = CAC_sorted_companies

				for_loop_effect = {
					start = 0
					end = CAC_companies^num
					value = i

					set_temp_variable = { added = 0 }

					for_each_loop = {
						array = CAC_sorted_companies
						index = j
						value = v
						break = added

						set_temp_variable = { index = CAC_sorted_companies^j }

						if = {
							limit = {
								AND = {
									check_variable = { CAC_companies_money^v < CAC_companies_money^i }
								}
							}

							add_to_array = {
								array = CAC_sorted_companies
								value = CAC_companies^i
								index = j
							}

							set_temp_variable = { added = 1 }
						}
					}

					if = {
						limit = { check_variable = { added = 0 } }

						add_to_array = {
							array = CAC_sorted_companies
							value = CAC_companies^i
							index = CAC_sorted_companies^num
						}
					}
				}
			}

			sort_value_click = {
				clear_array = CAC_sorted_companies

				for_loop_effect = {
					start = 0
					end = CAC_companies^num
					value = i

					set_temp_variable = { added = 0 }

					for_each_loop = {
						array = CAC_sorted_companies
						index = j
						value = v
						break = added

						set_temp_variable = { index = CAC_sorted_companies^j }

						if = {
							limit = {
								AND = {
									check_variable = { CAC_companies_value^v < CAC_companies_value^i }
								}
							}

							add_to_array = {
								array = CAC_sorted_companies
								value = CAC_companies^i
								index = j
							}

							set_temp_variable = { added = 1 }
						}
					}

					if = {
						limit = { check_variable = { added = 0 } }

						add_to_array = {
							array = CAC_sorted_companies
							value = CAC_companies^i
							index = CAC_sorted_companies^num
						}
					}
				}
			}

			sort_revenue_click = {
				clear_array = CAC_sorted_companies

				for_loop_effect = {
					start = 0
					end = CAC_companies^num
					value = i

					set_temp_variable = { added = 0 }

					for_each_loop = {
						array = CAC_sorted_companies
						index = j
						value = v
						break = added

						set_temp_variable = { index = CAC_sorted_companies^j }

						if = {
							limit = {
								AND = {
									check_variable = { CAC_companies_revenue^v < CAC_companies_revenue^i }
								}
							}

							add_to_array = {
								array = CAC_sorted_companies
								value = CAC_companies^i
								index = j
							}

							set_temp_variable = { added = 1 }
						}
					}

					if = {
						limit = { check_variable = { added = 0 } }

						add_to_array = {
							array = CAC_sorted_companies
							value = CAC_companies^i
							index = CAC_sorted_companies^num
						}
					}
				}
			}

			sort_factories_click = {
				clear_array = CAC_sorted_companies

				for_loop_effect = {
					start = 0
					end = CAC_companies^num
					value = i

					set_temp_variable = { added = 0 }

					for_each_loop = {
						array = CAC_sorted_companies
						index = j
						value = v
						break = added

						set_temp_variable = { index = CAC_sorted_companies^j }

						if = {
							limit = {
								AND = {
									check_variable = { CAC_companies_factories^v < CAC_companies_factories^i }
								}
							}

							add_to_array = {
								array = CAC_sorted_companies
								value = CAC_companies^i
								index = j
							}

							set_temp_variable = { added = 1 }
						}
					}

					if = {
						limit = { check_variable = { added = 0 } }

						add_to_array = {
							array = CAC_sorted_companies
							value = CAC_companies^i
							index = CAC_sorted_companies^num
						}
					}
				}
			}

			close_click = {
				clr_country_flag = CAC_companies_list
				clr_country_flag = ceo_window_open
				set_variable = { opened_company_details = -1 }
            }
		}

		properties = {
			available_companies_grid_item_icon = {
				image = "[CAC_icon_of_company]"
			}
		}

        dynamic_lists = {
            available_companies_grid = {
                array = CAC_sorted_companies
                entry_container = "available_companies_grid_list_item"
            }
        }
	}

    company_detail_window = {
		window_name = "company_detail_window"
        context_type = player_context

        visible = {
			ROOT = {
				AND = {
					is_ai = no
					check_variable = { opened_company_details > -1 }
					has_country_flag = CAC_companies_list
				}
			}
		}

		properties = {
			company_detail_icon = {
				image = "[CAC_icon_of_company_detail]"
			}
			company_history_tab = {
				frame = companies_history_tab
			}
			company_upgrades_tab = {
				frame = companies_upgrades_tab
			}
			selected_ceo_portrait = {
				image = "[CAC_get_selected_ceo_portrait]"
			}
			ceo_level_progressbar = {
				frame = CAC_companies_selected_ceo_xp^opened_company_details
			}
		}

		triggers = {			
			country_action_1_visible = {
				has_country_flag = country_actions_ui
			}

			country_action_2_visible = {
				has_country_flag = country_actions_ui
			}

			country_action_3_visible = {
				has_country_flag = country_actions_ui
			}

			country_action_4_visible = {
				has_country_flag = country_actions_ui
			}

			company_action_1_visible = {
				NOT = {
					has_country_flag = country_actions_ui
				}
			}

			company_action_2_visible = {
				NOT = {
					has_country_flag = country_actions_ui
				}	
			}

			company_action_3_visible = {
				NOT = {
					has_country_flag = country_actions_ui
				}	
			}
			company_action_4_visible = {
				NOT = {
					has_country_flag = country_actions_ui
				}	
			}

			company_action_1_click_enabled = {
				set_temp_variable = { cac_needed_money = 1 }
				set_temp_variable = { cac_less_than_or_equals_expenses_per_factory = -0.25 }
				AND = {
					custom_trigger_tooltip = {
						tooltip = CAC_have_money_tooltip
						check_variable = {
							var = CAC_companies_money^opened_company_details
							value = cac_needed_money
							compare = greater_than_or_equals
						}
					}
					custom_trigger_tooltip = {
						tooltip = CAC_less_than_or_equals_expenses_per_factory_tooltip
						check_variable = {
							var = CAC_companies_expenses_per_factory^opened_company_details
							value = cac_less_than_or_equals_expenses_per_factory
							compare = less_than_or_equals
						}
					}
					#NOT = { has_country_flag = company_action_1_timeout }
				}
			}

			company_action_2_click_enabled = {
				set_temp_variable = { cac_needed_money = 2.5 }
				set_temp_variable = { cac_less_than_or_equals_income_per_factory = 0.5 }
				AND = {
					#NOT = { has_country_flag = company_action_2_timeout }
					custom_trigger_tooltip = {
						tooltip = CAC_have_money_tooltip
						check_variable = {
							var = CAC_companies_money^opened_company_details
							value = cac_needed_money
							compare = greater_than_or_equals
						}
					}
					custom_trigger_tooltip = {
						tooltip = cac_less_than_or_equals_income_per_factory_tooltip
						check_variable = {
							var = CAC_companies_income_per_factory^opened_company_details
							value = cac_less_than_or_equals_income_per_factory
							compare = less_than_or_equals
						}
					}
				}
			}

			company_action_3_click_enabled = {
				
				set_temp_variable = { cac_needed_money = 5 }
				AND = {
					#NOT = { has_country_flag = company_action_3_timeout }
					custom_trigger_tooltip = {
						tooltip = CAC_have_money_tooltip
						check_variable = {
							var = CAC_companies_money^opened_company_details
							value = cac_needed_money
							compare = greater_than_or_equals
						}
					}
				}
			}

			company_action_4_click_enabled = {
				set_temp_variable = { cac_needed_money = 10 }
				AND = {
					custom_trigger_tooltip = {
						tooltip = CAC_have_money_tooltip
						check_variable = {
							var = CAC_companies_money^opened_company_details
							value = cac_needed_money
							compare = greater_than_or_equals
						}
					}
				}
			}

			country_action_1_click_enabled = {
				AND = {
					has_political_power > 99
					NOT = { has_country_flag = country_action_1_timeout }
					if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 0 } }
						NOT = { has_country_flag = contract_company_type_0_timeout }
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 1 } }
						NOT = { has_country_flag = contract_company_type_1_timeout }
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 2 } }
						NOT = { has_country_flag = contract_company_type_2_timeout }
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 3 } }
						NOT = { has_country_flag = contract_company_type_3_timeout }
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 4 } }
						NOT = { has_country_flag = contract_company_type_4_timeout }
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 5 } }
						NOT = { has_country_flag = contract_company_type_5_timeout }
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 6 } }
						NOT = { has_country_flag = contract_company_type_6_timeout }
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 7 } }
						NOT = { has_country_flag = contract_company_type_7_timeout }
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 8 } }
						NOT = { has_country_flag = contract_company_type_8_timeout }
					}
				}
			}

			country_action_2_click_enabled = {
				AND = {
					NOT = { has_country_flag = country_action_2_timeout }
				}
			}

			country_action_3_click_enabled = {
				AND = {
					NOT = { has_country_flag = country_action_3_timeout }
				}
			}

			country_action_4_click_enabled = {
				AND = {
					NOT = { has_country_flag = country_action_4_timeout }
				}
			}

			selected_ceo_portrait_visible = {
				check_variable = { CAC_companies_selected_ceo^opened_company_details > -1 }
			}
			selected_ceo_name_visible = {
				check_variable = { CAC_companies_selected_ceo^opened_company_details > -1 }
			}
			selected_ceo_type_visible = {
				check_variable = { CAC_companies_selected_ceo^opened_company_details > -1 }
			}
			ceo_level_progressbar_bg_visible = {
				check_variable = { CAC_companies_selected_ceo^opened_company_details > -1 }
			}
			ceo_level_progressbar_visible = {
				check_variable = { CAC_companies_selected_ceo^opened_company_details > -1 }
			}
			ceo_level_icon_visible = {
				AND = {
					check_variable = { CAC_companies_selected_ceo^opened_company_details > -1 }
				}
			}
			ceo_level_value_visible = {
				AND = {
					check_variable = { CAC_companies_selected_ceo^opened_company_details > -1 }
				}
			}

			select_ceo_button_empty_visible = {
				check_variable = { CAC_companies_selected_ceo^opened_company_details = -1 }
			}
		}

		effects = {
			company_action_switch_page_company_click = {
				clr_country_flag = country_actions_ui
			}

			company_action_switch_page_country_click = {
				set_country_flag = country_actions_ui
			}
			
			company_action_1_click = {
				set_country_flag = {
					flag = company_action_1_timeout
					days = 30
					value = 1
				}

                set_temp_variable = { cac_money_change = -1.0 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes

				set_temp_variable = { cac_expenses_per_factory_change = 0.02 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_expenses_per_factory_effect = yes
			}

			company_action_2_click = {
				set_country_flag = {
					flag = company_action_2_timeout
					days = 30
					value = 1
				}

                set_temp_variable = { cac_money_change = -2.5 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes
				
				set_temp_variable = { cac_income_per_factory_change = 0.02 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_income_per_factory_effect = yes
			}

			company_action_3_click = {
				set_country_flag = {
					flag = company_action_3_timeout
					days = 30
					value = 1
				}

                set_temp_variable = { cac_money_change = -5 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes

				set_temp_variable = { cac_additional_income_change = 0.05 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_additional_income_effect = yes

				set_temp_variable = { cac_value_change = 4 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_value_effect = yes
			}

			company_action_4_click = {
                set_temp_variable = { cac_money_change = -10 }

				if = {
					limit = { check_variable = { CAC_companies_selected_ceo^opened_company_details = 2 } }
					
					multiply_temp_variable = { cac_money_change = CAC_companies_selected_ceo_level_modifier^cac_slot }
				}

				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes

				set_temp_variable = { cac_factories_change = 1 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_factories_effect = yes
			}

			country_action_1_click = {
				set_country_flag = {
					flag = country_action_1_timeout
					days = 60
					value = 1
				}

				set_temp_variable = { money_to_change = -2 }
				multiply_temp_variable = { money_to_change = CAC_companies_modifier_from_size^opened_company_details }

				set_temp_variable = { treasury_change = money_to_change }
				modify_treasury_effect = yes

				add_political_power = -100

				multiply_temp_variable = { money_to_change = -1 }
				set_temp_variable = { cac_money_change = money_to_change }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes
				
				ROOT = {
					if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 0 } }
						add_timed_idea = {
							idea = CAC_company_type_0_idea
							days = 365
						}
						set_country_flag = {
							flag = contract_company_type_0_timeout
							days = 365
							value = 1
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 1 } }
						add_timed_idea = {
							idea = CAC_company_type_1_idea
							days = 365
						}
						set_country_flag = {
							flag = contract_company_type_1_timeout
							days = 365
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 2 } }
						add_timed_idea = {
							idea = CAC_company_type_2_idea
							days = 365
						}
						set_country_flag = {
							flag = contract_company_type_2_timeout
							days = 365
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 3 } }
						add_timed_idea = {
							idea = CAC_company_type_3_idea
							days = 365
						}
						set_country_flag = {
							flag = contract_company_type_3_timeout
							days = 365
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 4 } }
						add_timed_idea = {
							idea = CAC_company_type_4_idea
							days = 365
						}
						set_country_flag = {
							flag = contract_company_type_4_timeout
							days = 365
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 5 } }
						add_timed_idea = {
							idea = CAC_company_type_5_idea
							days = 365
						}
						set_country_flag = {
							flag = contract_company_type_5_timeout
							days = 365
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 6 } }
						add_timed_idea = {
							idea = CAC_company_type_6_idea
							days = 365
						}
						set_country_flag = {
							flag = contract_company_type_6_timeout
							days = 365
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 7 } }
						add_timed_idea = {
							idea = CAC_company_type_7_idea
							days = 365
						}
						set_country_flag = {
							flag = contract_company_type_7_timeout
							days = 365
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 8 } }
						add_timed_idea = {
							idea = CAC_company_type_8_idea
							days = 365
						}
						set_country_flag = {
							flag = contract_company_type_8_timeout
							days = 365
						}
					}
				}
			}

			country_action_2_click = {
				set_country_flag = {
					flag = country_action_2_timeout
					days = 60
					value = 1
				}

				set_temp_variable = { money_to_change = -3 }
				multiply_temp_variable = { money_to_change = CAC_companies_modifier_from_size^opened_company_details }

				set_temp_variable = { treasury_change = money_to_change }
				modify_treasury_effect = yes

				multiply_temp_variable = { money_to_change = -1 }

				set_temp_variable = { cac_money_change = money_to_change }
				set_temp_variable = { cac_slot = opened_company_details }

				ROOT = {
					if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 0 } }
						add_tech_bonus = {
							bonus = 0.1
							uses = 2
							category = CAT_Civilian
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 1 } }
						add_tech_bonus = {
							bonus = 0.1
							uses = 2
							category = CAT_excavation_tech
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 2 } }
						add_tech_bonus = {
							bonus = 0.1
							uses = 2
							category = CAT_energy
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 3 } }
						add_tech_bonus = {
							bonus = 0.1
							uses = 2
							category = CAT_util
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 4 } }
						add_tech_bonus = {
							bonus = 0.1
							uses = 2
							category = CAT_internet_tech
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 5 } }
						add_tech_bonus = {
							bonus = 0.1
							uses = 1
							category = CAT_air_eqp
						}
						add_tech_bonus = {
							bonus = 0.1
							uses = 1
							category = CAT_space
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 6 } }
						add_tech_bonus = {
							bonus = 0.1
							uses = 2
							category = CAT_construction_tech
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 7 } }
						add_tech_bonus = {
							bonus = 0.1
							uses = 2
							category = CAT_genes
						}
					}
					else_if = {
						limit = { check_variable = { CAC_companies_type^opened_company_details = 8 } }
						add_tech_bonus = {
							bonus = 0.1
							uses = 1
							category = CAT_internet_tech
						}
						add_tech_bonus = {
							bonus = 0.1
							uses = 1
							category = CAT_computing_tech
						}
					}
				}

				CAC_modify_money_effect = yes
			}

			country_action_3_click = {
				set_country_flag = {
					flag = country_action_3_timeout
					days = 60
					value = 1
				}

				set_temp_variable = { money_to_change = -5 }
				multiply_temp_variable = { money_to_change = CAC_companies_modifier_from_size^opened_company_details }

				set_temp_variable = { treasury_change = money_to_change }
				modify_treasury_effect = yes

				multiply_temp_variable = { money_to_change = -0.9 }

				set_temp_variable = { int_investment_change = money_to_change }
				modify_international_investment_effect = yes

				set_temp_variable = { cac_money_change = money_to_change }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes
			}

			country_action_4_click = {
				set_country_flag = {
					flag = country_action_4_timeout
					days = 60
					value = 1
				}

				set_temp_variable = { money_to_change = -8 }
				multiply_temp_variable = { money_to_change = CAC_companies_modifier_from_size^opened_company_details }

				set_temp_variable = { treasury_change = money_to_change }
				modify_treasury_effect = yes

				multiply_temp_variable = { money_to_change = -0.8 }

				set_temp_variable = { cac_money_change = money_to_change }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes
			}

			select_ceo_btn_click = {
				if = {
					limit = { has_country_flag = ceo_window_open }

					clr_country_flag = ceo_window_open
				}
				else = {
					set_country_flag = ceo_window_open
				}
			}

			company_history_tab_click = {
				set_variable = { companies_history_tab = 1 }
				set_variable = { companies_upgrades_tab = 2 }

				clr_country_flag = ceo_window_open
			}

			company_upgrades_tab_click = {
				set_variable = { companies_history_tab = 2 }
				set_variable = { companies_upgrades_tab = 1 }

				clr_country_flag = ceo_window_open
			}

			close_click = {
                set_variable = { opened_company_details = -1 }
            }
		}
	}

	company_history_window = {
		window_name = "company_history_window"
		context_type = player_context
		parent_window_name = "company_detail_window"

		visible = {
			ROOT = {
				AND = {
					is_ai = no
					check_variable = { opened_company_details > -1 }
					check_variable = { companies_history_tab = 1 }
				}
			}
		}

		dynamic_lists = {
            company_statistics_grid = {
                array = CAC_companies
                entry_container = "company_statistics_grid_item"
            }

			company_global_statistics_grid = {
                array = global.CAC_global_companies
                entry_container = "company_global_statistics_grid_item"
            }
        }

		properties = {
			company_statistics_grid_icon = {
				image = "[CAC_icon_of_company_detail]"
			}
			company_global_statistics_grid_icon = {
				image = "[CAC_icon_of_company]"
			}
		}
	}

	company_select_ceo_window = {
		window_name = "company_select_ceo_window"
        context_type = player_context
		parent_window_name = "company_detail_window"

		visible = {
			ROOT = {
				AND = {
					has_country_flag = ceo_window_open
				}
			}
		}

		triggers = {
			select_ceo_btn_click_enabled = {
				AND = {
					has_political_power > 99
					check_variable = { CAC_companies_selected_ceo^opened_company_details = -1 }
				}
			}
			ceo_list_item_btn_click_enabled = {
				check_variable = {
					var = v
					value = CAC_companies_selected_ceo^opened_company_details
					compare = not_equals
				}
			}
			ceo_unassign_click_enabled = {
				check_variable = { CAC_companies_selected_ceo^opened_company_details > -1 }
			}
		}

		effects = {
			select_ceo_btn_click = {
				add_political_power = -100

				set_temp_variable = { cac_selected_ceo = v }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_select_ceo_effect = yes
			}
			ceo_unassign_click = {
				set_temp_variable = { cac_selected_ceo = -1 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_select_ceo_effect = yes
			}
			close_click = {
				clr_country_flag = ceo_window_open
			}
		}

		dynamic_lists = {
			select_ceo_list_grid = {
				array = global.CAC_available_ceo_list
				entry_container = "select_ceo_list_item"
			}
		}

		properties = {
			ceo_list_portrait = {
				image = "[CAC_get_ceo_portrait]"
			}
			ceo_type_icon = {
				image = "[CAC_get_ceo_type_icon]"
			}
		}
	}

	adopt_foreign_company_window = {
		window_name = "adopt_foreign_company_window"
        context_type = diplomatic_action

		triggers = {
			foreign_available_companies_select_click_enabled = {
				AND = {
					check_variable = { ROOT.CAC_foreign_companies_limit > ROOT.CAC_foreign_companies^num }
					check_variable = {
						var = v
						value = selected_foreign_company
						compare = not_equals
					}
				}
			}
			companies_dismiss_button_click_enabled = {
				any_of = {
					array = ROOT.CAC_foreign_companies
					index = index
					value = company_id
					
					AND = {
						check_variable = { company_id = v }
						check_variable = { ROOT.CAC_foreign_companies_countries^index = THIS }
					}
				}
			}
		}

		effects = {
			foreign_available_companies_select_click = {
				set_variable = { selected_foreign_company = v }
			}
			companies_dismiss_button_click = {
				for_each_loop = {
					array = ROOT.CAC_foreign_companies
					index = index
					value = company_id
					break = break

					if = {
						limit = {
							AND = {
								check_variable = { company_id = v }
								check_variable = { ROOT.CAC_foreign_companies_countries^index = THIS }
							}
						}

						remove_from_array = {
							array = ROOT.CAC_foreign_companies
							index = index
						}
						remove_from_array = {
							array = ROOT.CAC_foreign_companies_countries
							index = index
						}

						set_temp_variable = { cac_type = THIS.CAC_companies_type^i }
						ROOT = { CAC_remove_bonuses_from_foreign_company_effect = yes }

						THIS = {
							set_variable = { CAC_companies_income_modifier^i = -0.1 }

							set_temp_variable = { cac_slot = v }
							set_temp_variable = { cac_additional_income_change = -0.1 }
							CAC_modify_additional_income_effect = yes
						}

						set_temp_variable = { break = 1 }
					}
				}
			}
		}

		properties = {
			foreign_companies_grid_item_icon = {
				image = "[CAC_icon_of_company]"
			}
			#foreign_available_companies_select = {
			#	frame = ROOT.
			#}
		}

		dynamic_lists = {
			foreign_available_companies_grid = {
                array = ROOT.CAC_companies
                entry_container = "foreign_available_companies_grid_list_item"
            }
		}
	}
}