# Author(s): 4RH1T3CT0R
# Purpose: Diplomatic restriction triggers for French extremist factions and RPF

# Check if France is on an extremist political path
FRA_on_extremist_path = {
	OR = {
		has_country_flag = FRA_national_rally_path
		has_country_flag = FRA_communist_path
		has_country_flag = FRA_lfi_path
		has_country_flag = FRA_pcf_path
	}
}

# Check if France is on an anti-American path (includes RPF Gaullist path)
FRA_on_anti_american_path = {
	OR = {
		has_country_flag = FRA_rpf_path
		has_country_flag = FRA_national_rally_path
		has_country_flag = FRA_communist_path
		has_country_flag = FRA_lfi_path
		has_country_flag = FRA_pcf_path
		has_completed_focus = FRA_anti_usa
	}
}

# Check if France is on a far-right path (National Rally)
FRA_on_far_right_path = {
	OR = {
		has_country_flag = FRA_national_rally_path
		has_completed_focus = FRA_FN_death
	}
}

# Check if France is on a far-left path (PCF or LFI)
FRA_on_far_left_path = {
	OR = {
		has_country_flag = FRA_communist_path
		has_country_flag = FRA_lfi_path
		has_country_flag = FRA_pcf_path
		has_completed_focus = FRA_leave_nato_PCF
	}
}

# Check if France is on Gaullist RPF path
FRA_on_gaullist_path = {
	OR = {
		has_country_flag = FRA_rpf_path
		has_completed_focus = FRA_back_gaulism
	}
}

# Rule: Cannot ally with USA (hard block for extremist paths)
FRA_cannot_ally_usa = {
	custom_trigger_tooltip = {
		tooltip = FRA_cannot_ally_usa_tt
		OR = {
			# PCF and LFI have hard blocks on USA alliance
			has_country_flag = FRA_communist_path
			has_country_flag = FRA_pcf_path
			has_country_flag = FRA_lfi_path
			has_idea = FRA_anti_american_stance
			has_idea = FRA_communist_foreign_policy
			has_idea = FRA_lfi_non_aligned_policy
		}
	}
}

# Rule: Cannot ally with NATO members (for full NATO exit paths)
FRA_cannot_ally_nato_members = {
	custom_trigger_tooltip = {
		tooltip = FRA_cannot_ally_nato_members_tt
		OR = {
			has_idea = FRA_left_nato
			has_country_flag = FRA_left_nato_permanently
		}
	}
}

# Rule: Cannot join American-led military operations
FRA_cannot_join_american_operations = {
	custom_trigger_tooltip = {
		tooltip = FRA_cannot_join_american_operations_tt
		OR = {
			FRA_on_gaullist_path = yes
			FRA_on_far_right_path = yes
			FRA_on_far_left_path = yes
			has_idea = FRA_gaullist_foreign_policy
			has_idea = FRA_strategic_independance
		}
	}
}

# Rule: Cannot support EU federalization
FRA_blocks_eu_federalization = {
	custom_trigger_tooltip = {
		tooltip = FRA_blocks_eu_federalization_tt
		OR = {
			FRA_on_gaullist_path = yes
			FRA_on_far_right_path = yes
			FRA_on_far_left_path = yes
			has_idea = FRA_sovereigntist_eu_policy
		}
	}
}

# Rule: Cannot support NATO expansion
FRA_blocks_nato_expansion = {
	custom_trigger_tooltip = {
		tooltip = FRA_blocks_nato_expansion_tt
		OR = {
			FRA_on_far_left_path = yes
			has_idea = FRA_distance_nato
			has_idea = FRA_left_nato
		}
	}
}

# Check if a country is acceptable as ally for France based on current political path
FRA_can_ally_target_country = {
	custom_trigger_tooltip = {
		tooltip = FRA_can_ally_target_country_tt
		NOT = {
			AND = {
				FRA_cannot_ally_usa = yes
				FROM = { tag = USA }
			}
		}
		NOT = {
			AND = {
				FRA_cannot_ally_nato_members = yes
				FROM = { has_idea = NATO_member }
			}
		}
	}
}

# Check if France can request military access from USA
FRA_can_request_usa_military_access = {
	NOT = {
		FRA_on_far_left_path = yes
	}
	NOT = {
		has_idea = FRA_communist_foreign_policy
	}
}

# Check if France is eligible for American military aid
FRA_eligible_for_usa_aid = {
	custom_trigger_tooltip = {
		tooltip = FRA_eligible_for_usa_aid_tt
		NOT = { FRA_on_anti_american_path = yes }
		NOT = { has_idea = FRA_anti_american_stance }
		NOT = { has_completed_focus = FRA_anti_usa }
	}
}

# Check if France can participate in joint NATO exercises
FRA_can_join_nato_exercises = {
	custom_trigger_tooltip = {
		tooltip = FRA_can_join_nato_exercises_tt
		NOT = { has_idea = FRA_left_nato }
		NOT = { has_idea = FRA_distance_nato }
		NOT = { has_country_flag = FRA_left_nato_permanently }
	}
}

# Check if France can host American military bases
FRA_can_host_american_bases = {
	custom_trigger_tooltip = {
		tooltip = FRA_can_host_american_bases_tt
		NOT = { FRA_on_gaullist_path = yes }
		NOT = { FRA_on_far_right_path = yes }
		NOT = { FRA_on_far_left_path = yes }
		NOT = { has_idea = FRA_strategic_independance }
	}
}

# Historical trigger: De Gaulle withdrew from NATO integrated command in 1966
FRA_historically_left_nato_command = {
	custom_trigger_tooltip = {
		tooltip = FRA_historically_left_nato_command_tt
		OR = {
			has_completed_focus = FRA_leave_nato
			has_completed_focus = FRA_distance_nato
			has_completed_focus = FRA_distance_nato_lfi
			has_idea = FRA_distance_nato
		}
	}
}

# Check if France maintains independent nuclear deterrent (Force de Frappe)
FRA_has_independent_nuclear_deterrent = {
	custom_trigger_tooltip = {
		tooltip = FRA_has_independent_nuclear_deterrent_tt
		has_tech = nuclear_bombs
		NOT = { has_country_flag = FRA_shared_nuclear_command }
	}
}

# Russia relations check for National Rally (historically pro-Russian)
FRA_fn_russia_alignment = {
	custom_trigger_tooltip = {
		tooltip = FRA_fn_russia_alignment_tt
		FRA_on_far_right_path = yes
		NOT = { has_war_with = SOV }
		date < 2022.2.24  # Before Ukraine invasion changed dynamics
	}
}

# Check if France should have relations malus with USA
FRA_has_usa_relations_penalty = {
	OR = {
		FRA_on_anti_american_path = yes
		has_idea = FRA_anti_american_stance
		has_idea = FRA_gaullist_foreign_policy
		has_idea = FRA_communist_foreign_policy
		has_idea = FRA_lfi_non_aligned_policy
	}
}

# Check if France should have relations bonus with Russia
FRA_has_russia_relations_bonus = {
	OR = {
		FRA_on_gaullist_path = yes
		FRA_fn_russia_alignment = yes
	}
}

# Check if France should have relations bonus with China
FRA_has_china_relations_bonus = {
	OR = {
		FRA_on_gaullist_path = yes
		FRA_on_far_left_path = yes
	}
}

# Check if France recognizes Palestine (required for far-left paths)
FRA_must_recognize_palestine = {
	custom_trigger_tooltip = {
		tooltip = FRA_must_recognize_palestine_tt
		FRA_on_far_left_path = yes
	}
}

# Check if France can support Israel
FRA_can_support_israel = {
	NOT = {
		AND = {
			FRA_on_far_left_path = yes
			NOT = { has_country_flag = FRA_supports_two_state_solution }
		}
	}
}

#################################################
# Terrorist Attack Triggers
# Based on historical French security vulnerabilities
#################################################

# Check if France has strong intelligence agency (counter-terrorism capability)
FRA_has_strong_intelligence = {
	custom_trigger_tooltip = {
		tooltip = FRA_has_strong_intelligence_tt
		has_intelligence_agency = yes
		OR = {
			has_done_agency_upgrade = upgrade_passive_defense
			has_done_agency_upgrade = upgrade_interrogation_techniques
			num_of_operatives > 3
		}
	}
}

# Check if France has weak intelligence agency
FRA_has_weak_intelligence = {
	custom_trigger_tooltip = {
		tooltip = FRA_has_weak_intelligence_tt
		OR = {
			has_intelligence_agency = no
			AND = {
				NOT = { has_done_agency_upgrade = upgrade_passive_defense }
				NOT = { has_done_agency_upgrade = upgrade_interrogation_techniques }
				num_of_operatives < 2
			}
		}
	}
}

# Check if France has high social/police spending (social_04, social_05, social_06)
FRA_has_high_police_budget = {
	custom_trigger_tooltip = {
		tooltip = FRA_has_high_police_budget_tt
		OR = {
			has_idea = social_04
			has_idea = social_05
			has_idea = social_06
		}
	}
}

# Check if France has low social/police spending (social_01, social_02)
FRA_has_low_police_budget = {
	custom_trigger_tooltip = {
		tooltip = FRA_has_low_police_budget_tt
		OR = {
			has_idea = social_01
			has_idea = social_02
		}
	}
}

# Check if France is vulnerable to terrorist attacks (base conditions)
FRA_vulnerable_to_terrorism = {
	custom_trigger_tooltip = {
		tooltip = FRA_vulnerable_to_terrorism_tt
		OR = {
			# Very low stability (crisis level)
			has_stability < 0.25
			# Combination of low stability and war
			AND = {
				has_stability < 0.35
				has_war = yes
			}
			# Combination of low stability and extremist path
			AND = {
				has_stability < 0.40
				FRA_on_extremist_path = yes
			}
			# Low social spending makes country vulnerable
			AND = {
				has_stability < 0.40
				FRA_has_low_police_budget = yes
			}
			# Weak intelligence makes country vulnerable
			AND = {
				has_stability < 0.35
				FRA_has_weak_intelligence = yes
			}
		}
	}
}

# Check if France has heightened security (blocks terrorist events)
FRA_has_heightened_security = {
	custom_trigger_tooltip = {
		tooltip = FRA_has_heightened_security_tt
		OR = {
			has_country_flag = FRA_vigipirate_active
			has_country_flag = FRA_etat_urgence_active
			has_idea = FRA_heightened_security
			has_idea = FRA_state_of_emergency_terrorism
		}
	}
}

# Check if France can be targeted for minor attacks (metro, car bombs)
FRA_can_have_minor_attack = {
	FRA_vulnerable_to_terrorism = yes
	NOT = { FRA_has_heightened_security = yes }
	NOT = { has_country_flag = FRA_recent_terror_attack }
	NOT = { has_country_flag = FRA_terror_chain_complete }
}

# Check if France can be targeted for medium attacks (police stations, markets)
FRA_can_have_medium_attack = {
	FRA_vulnerable_to_terrorism = yes
	NOT = { FRA_has_heightened_security = yes }
	NOT = { has_country_flag = FRA_recent_terror_attack }
	has_country_flag = FRA_terror_level_1
	# Stability check - relaxed during active terror wave
	OR = {
		has_stability < 0.30  # Normal threshold
		AND = {
			has_country_flag = FRA_terror_wave_active
			has_stability < 0.40  # Relaxed threshold during wave
		}
	}
}

# Check if France can be targeted for major attacks (Louvre, military bases)
FRA_can_have_major_attack = {
	FRA_vulnerable_to_terrorism = yes
	NOT = { FRA_has_heightened_security = yes }
	NOT = { has_country_flag = FRA_recent_terror_attack }
	has_country_flag = FRA_terror_level_2
	# Stability check - relaxed during active terror wave
	OR = {
		has_stability < 0.25  # Normal threshold
		AND = {
			has_country_flag = FRA_terror_wave_active
			has_stability < 0.35  # Relaxed threshold during wave
		}
	}
}

# Check if France can be targeted for catastrophic attacks (Eiffel Tower, nuclear)
FRA_can_have_catastrophic_attack = {
	FRA_vulnerable_to_terrorism = yes
	NOT = { FRA_has_heightened_security = yes }
	NOT = { has_country_flag = FRA_recent_terror_attack }
	has_country_flag = FRA_terror_level_3
	# Stability check - relaxed during active terror wave
	OR = {
		has_stability < 0.20  # Normal threshold
		AND = {
			has_country_flag = FRA_terror_wave_active
			has_stability < 0.30  # Relaxed threshold during wave
		}
	}
	# Must be in a really bad situation
	OR = {
		has_war = yes
		FRA_on_extremist_path = yes
		has_civil_war = yes
	}
}

# Check if terror wave has been broken by counter-terrorism efforts
FRA_terror_wave_broken = {
	custom_trigger_tooltip = {
		tooltip = FRA_terror_wave_broken_tt
		OR = {
			# Sustained strong security breaks the wave
			AND = {
				FRA_has_strong_intelligence = yes
				FRA_has_high_police_budget = yes
				has_idea = FRA_state_of_emergency_terrorism
				NOT = { has_country_flag = FRA_recent_terror_attack }
				has_stability > 0.40
			}
			# Counter-terrorism success (set by decisions)
			has_country_flag = FRA_terror_networks_dismantled
		}
	}
}

# Check if attack was successfully prevented
FRA_attack_prevented = {
	custom_trigger_tooltip = {
		tooltip = FRA_attack_prevented_tt
		OR = {
			has_country_flag = FRA_attack_foiled
			AND = {
				has_idea = FRA_heightened_security
				has_stability > 0.30
			}
			# Strong intelligence can prevent attacks
			AND = {
				FRA_has_strong_intelligence = yes
				FRA_has_high_police_budget = yes
			}
		}
	}
}
